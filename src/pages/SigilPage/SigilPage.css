/* ────────────────────────────────────────────────────────────────
   SigilPage.css — Atlantean Priest-King ◇ Sentient Breath
   Mobile-first • Accessible • “Buttery” interactions
   (Breathing gradient across the page; no rotating glyphs)
────────────────────────────────────────────────────────────────── */

/* ========== 1) RESET & TOKENS ================================== */
*,
*::before,
*::after { box-sizing: border-box; }

:root{
  /* Surfaces & ink */
  --sp-bg: radial-gradient(1200px 800px at 50% 0%, rgba(0,0,0,.72), rgba(0,0,0,.9) 60%), #040708;
  --sp-text: #e7fbf7;
  --sp-dim:  #aee8df;
  --sp-glass: rgba(12,18,20,.55);
  --sp-border: rgba(255,255,255,.08);
  --sp-ring: rgba(55,230,212,.45);

  /* Accent palette */
  --c-cyan:  #37e6d4;
  --c-cyan-2:#5ce1ff;
  --c-vio:   #a78bfa;
  --c-mint:  #57f0c7;
  --c-rose:  #ff6b6b;
  --c-ink:   #e7fbf7;

  /* Type */
  --font-sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

  /* Motion */
  --pulse: 5.236s; /* one breath */
  --ease-breath: cubic-bezier(.33,.01,.24,1);
  --tap-scale: .985;
  --spinner-size: 18px;

  /* Busy sheens */
  --busy-sheen: linear-gradient(115deg, rgba(255,255,255,.28), rgba(255,255,255,0) 60%);
  --busy-stripes: repeating-linear-gradient(115deg, rgba(55,230,212,.18) 0 14px, rgba(92,225,255,.12) 14px 28px);

  /* Dynamic theme (overridden by TSX) */
  --crystal-hue: 180;
  --crystal-accent: #00FFD0;

  /* Safe areas */
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-right:  env(safe-area-inset-right, 0px);

  /* LIVE badge */
  --live-breath: 5.236s;
  --ether-cyan:#19e6ff; --ether-ice:#c7f5ff; --ether-deep:#0aa8ff;
}

/* Custom properties used for breathing gradients */
@property --breath-scale { syntax: "<number>"; initial-value: 0; inherits: false; }
@property --breath-hue   { syntax: "<angle>";  initial-value: 0deg; inherits: false; }

/* ========== 2) BASE ============================================ */
html.sigil-scroll, body{
  min-height:100%;
  height:auto;
  overflow-y:auto;
  background:var(--sp-bg);
  color:var(--sp-text);
  font-family:var(--font-sans);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

.sigilpage{
  position:relative;
  min-height:100dvh;
  padding:12px;
  --veil1: radial-gradient(1400px 900px at 10% 10%, rgba(0,255,222,.10), transparent 60%);
  --veil2: radial-gradient(1000px 800px at 90% 80%, rgba(167,139,250,.10), transparent 60%);
  --veil3: radial-gradient(900px 700px at 50% 90%, rgba(92,225,255,.10), transparent 60%);
}

/* ── Breath mantle (fixed, subtle, hue-sway + inhale/exhale) ── */
.sigilpage::before{
  content:"";
  position:fixed; inset:-10%;
  z-index:0; pointer-events:none;
  background:
    radial-gradient(65% 55% at 50% calc(52% + (var(--breath-scale)*2%)),
      color-mix(in oklab, var(--crystal-accent) 24%, transparent) 0%,
      transparent 62%),
    radial-gradient(85% 65% at 20% 20%,
      color-mix(in oklab, #5ce1ff 18%, transparent) 0%,
      transparent 70%),
    radial-gradient(85% 65% at 80% 80%,
      color-mix(in oklab, #a78bfa 16%, transparent) 0%,
      transparent 70%);
  filter: blur(28px) saturate(calc(1.05 + var(--breath-scale)*.25))
          hue-rotate(var(--breath-hue));
  opacity: calc(.22 + var(--breath-scale)*.18);
  transform: scale(calc(1 + var(--breath-scale)*.028)) translateY(calc(var(--breath-scale)*-1.2%));
  animation: breath-mantle var(--pulse) var(--ease-breath) infinite;
}

/* Aurora veil layers (kept, now synced to the breath) */
.sp-veil,
.sp-veil-stars{
  position:fixed; inset:0; pointer-events:none; z-index:0;
  contain: layout style paint;
}
.sp-veil{
  background: var(--veil1), var(--veil2), var(--veil3);
  opacity:.9; filter:saturate(1.06);
  animation: veil-breathe var(--pulse) var(--ease-breath) infinite;
}
.sp-veil-stars{
  background:
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.12), transparent 60%),
    radial-gradient(1px 1px at 70% 60%, rgba(255,255,255,.10), transparent 60%),
    radial-gradient(1px 1px at 40% 80%, rgba(255,255,255,.08), transparent 60%);
  opacity:.25; animation: stars-breathe var(--pulse) ease-in-out infinite;
}

@keyframes breath-mantle{
  0%   { --breath-scale: 0;   --breath-hue: 0deg;   }
  50%  { --breath-scale: .9;  --breath-hue: 6deg;   }
  100% { --breath-scale: 0;   --breath-hue: 0deg;   }
}
@keyframes veil-breathe{
  0%,100%{ transform: translate3d(0,0,0) scale(1);   filter: blur(0px) saturate(1.04); opacity:.87; }
  50%    { transform: translate3d(0,-1.2%,0) scale(1.012); filter: blur(.4px) saturate(1.12); opacity:.93; }
}
@keyframes stars-breathe{
  0%,100%{ opacity:.25; transform: translateY(0); }
  50%    { opacity:.35; transform: translateY(-.6%); }
}

/* Layout shell */
.sp-viewport{ position:relative; z-index:1; width:100%; margin:0 auto; padding-bottom: calc(104px + var(--safe-bottom)); }
.sp-shell{ max-width:1120px; margin:0 auto; padding:clamp(12px,2.2vw,24px); display:grid; gap:clamp(16px,2.4vw,24px); }

/* ========== 3) HEADER ========================================== */
.sp-header{ display:grid; gap:6px; text-align:center; }
.sp-kicker{ letter-spacing:.16em; text-transform:uppercase; font-size:.75rem; color:var(--sp-dim); animation: text-glow var(--pulse) linear infinite; }
@keyframes text-glow{ 0%,100%{ text-shadow:0 0 0 rgba(92,225,255,0); opacity:.9; } 50%{ text-shadow:0 0 12px rgba(92,225,255,.35); opacity:1; } }
.sp-title{ position:relative; font-weight:700; font-size:clamp(22px,3.8vw,38px); margin:0; text-shadow:0 0 24px var(--crystal-accent); }
.sp-title::after{
  content:""; display:block; height:2px; width:120px; margin:8px auto 0;
  background: linear-gradient(90deg, transparent, rgba(55,230,212,.5), transparent);
  filter: blur(.2px); animation: title-underline var(--pulse) var(--ease-breath) infinite;
}
@keyframes title-underline{ 0%,100%{ transform: scaleX(.92); opacity:.45; } 50%{ transform: scaleX(1.08); opacity:.9; } }
.sp-sub{ margin:2px 0 6px; color:var(--sp-dim); font-size:.95rem; }

/* ========== 4) AUTH BADGE ====================================== */
.sp-auth{ display:flex; justify-content:center; margin-top:6px; }

.auth-badge{
  position:relative; isolation:isolate;
  border:1px solid rgba(255,255,255,.12);
  background: linear-gradient(180deg, rgba(18,24,26,.58), rgba(18,24,26,.36));
  padding:12px 18px; border-radius:999px;
  font-weight:800; font-size:.96rem; color:var(--sp-text);
  cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent; touch-action:manipulation;
  -webkit-backdrop-filter: blur(8px) saturate(1.12); backdrop-filter: blur(8px) saturate(1.12);
  box-shadow: 0 1px 0 rgba(255,255,255,.10) inset, 0 -1px 0 rgba(0,0,0,.35) inset, 0 0 0 0 rgba(55,230,212,0);
  transition: transform .06s ease, box-shadow .18s ease, border-color .18s ease;
  animation: seal-breathe var(--pulse) var(--ease-breath) infinite;
}
.auth-badge--ok{ color: var(--c-mint); border-color: rgba(87,240,199,.38); outline:1px solid color-mix(in oklab, var(--crystal-accent), transparent 70%); }
.auth-badge--bad{ color: var(--c-rose); border-color: rgba(255,107,107,.42); }
.auth-badge--checking{ color: var(--c-cyan-2); }
.auth-badge::before{
  content:""; position:absolute; left:6px; right:6px; top:4px; height:56%;
  border-radius:999px; background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,0)); opacity:.28; pointer-events:none;
}
.auth-badge::after{
  content:""; position:absolute; inset:-2px; border-radius:inherit; pointer-events:none;
  background: linear-gradient(115deg, transparent 25%, rgba(255,255,255,.28) 47%, rgba(255,255,255,.08) 60%, transparent 72%),
              radial-gradient(60% 40% at 50% 50%, rgba(55,230,212,.10), transparent 65%);
  mix-blend-mode: screen; opacity:0; transform: translateX(-35%) skewX(-8deg);
  animation: sheen var(--pulse) var(--ease-breath) infinite;
}
.auth-badge:active{ transform: scale(var(--tap-scale)); }
@keyframes seal-breathe{ 0%,100%{ box-shadow:0 1px 0 rgba(255,255,255,.10) inset, 0 -1px 0 rgba(0,0,0,.35) inset, 0 0 0 rgba(55,230,212,0); } 50%{ box-shadow:0 1px 0 rgba(255,255,255,.14) inset, 0 -1px 0 rgba(0,0,0,.38) inset, 0 0 34px rgba(55,230,212,.12); } }
@keyframes sheen{
  0%{ opacity:0; transform: translateX(-35%) skewX(-8deg); }
  35%{ opacity:.7; transform: translateX(0%) skewX(-8deg); }
  65%{ opacity:0; transform: translateX(35%) skewX(-8deg); }
  100%{ opacity:0; transform: translateX(35%) skewX(-8deg); }
}
/* lock background scroll while overlay is open */
body.bp-open { overflow: hidden; }

/* neutralize ancestor transforms ONLY while overlay is open */
body.bp-open :where(.sigilpage, .sp-viewport, .sp-shell, .sp-veil, .sp-veil-stars) {
  transform: none !important;
  filter: none !important;
  perspective: none !important;
}

/* clickable auth badge */
.auth-badge[role="button"] { cursor: pointer; }

/* ===== Breath Proof overlay ===== */
.sp-breathproof__backdrop {
  position: fixed;
  inset: 0;
  z-index: 10000;
  background: rgba(8, 12, 16, 0.5);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);

  /* center the panel within the *visible* viewport */
  display: grid;
  place-items: center;

  opacity: 0;
  animation: bp-fade-in 160ms ease forwards;
}

/* the panel itself, centered by the backdrop grid */
.sp-breathproof {
  position: relative; /* no fixed/absolute here */
  z-index: 10001;

  width: min(840px, calc(100vw - 32px));
  max-width: calc(100vw - 32px);
  max-height: min(90svh, 90dvh, 720px);
  overflow: auto;

  border-radius: 16px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.55);
  background: var(--card-bg, #0b0f14);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 16px calc(16px + env(safe-area-inset-right)) 16px calc(16px + env(safe-area-inset-left));

  animation: bp-pop 200ms cubic-bezier(.2,.75,.3,1) forwards;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

/* close button (top-right) */
.sp-breathproof__close {
  position: absolute;
  top: max(8px, env(safe-area-inset-top));
  right: max(10px, env(safe-area-inset-right));
  font-size: 20px;
  line-height: 1;
  width: 32px; height: 32px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: inherit;
  cursor: pointer;
  opacity: 0.75;
}
.sp-breathproof__close:hover { opacity: 1; }

/* key/value grid */
.kv {
  display: grid;
  grid-template-columns: max-content 1fr;
  gap: 6px 12px;
  margin: 10px 0;
}
.kv dt { opacity: 0.75; }
.kv dd { margin: 0; }
.kv code.wrap { word-break: break-word; overflow-wrap: anywhere; }

/* actions row */
.sp-breathproof__actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

/* small screens: allow a bottom-sheet feel but still centered by grid */
@media (max-width: 640px) {
  .sp-breathproof {
    width: min(720px, calc(100vw - 16px));
    max-height: min(92svh, 92dvh);
    border-bottom-left-radius: max(16px, env(safe-area-inset-left));
    border-bottom-right-radius: max(16px, env(safe-area-inset-right));
  }
}

/* animations */
@keyframes bp-pop {
  from { transform: scale(0.98); opacity: 0; }
  to   { transform: scale(1);     opacity: 1; }
}
@keyframes bp-fade-in { from { opacity: 0; } to { opacity: 1; } }

/* Verified variant (single source of truth) */
.auth-badge--verified{
  --ok-h: 150; --ok-s: 80%; --ok-l: 38%;
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px; border-radius:999px; font-weight:600; letter-spacing:.2px;
  background: linear-gradient(180deg,
    hsl(var(--ok-h) var(--ok-s) calc(var(--ok-l) + 22%) / .14),
    hsl(var(--ok-h) var(--ok-s) calc(var(--ok-l) + 14%) / .10));
  border:1px solid hsl(var(--ok-h) var(--ok-s) var(--ok-l) / .35);
  color:hsl(var(--ok-h) var(--ok-s) var(--ok-l));
  box-shadow: 0 0 0 1px hsl(var(--ok-h) var(--ok-s) var(--ok-l) / .08) inset, 0 1px 6px hsl(var(--ok-h) var(--ok-s) 8% / .2);
}
.auth-badge--verified .check{
  width:18px; height:18px; border-radius:999px;
  display:grid; place-items:center; font-size:12px; line-height:1;
  background:hsl(var(--ok-h) var(--ok-s) var(--ok-l)); color:#fff;
  box-shadow:0 0 0 1px hsl(var(--ok-h) var(--ok-s) var(--ok-l) / .4);
}
/* ensure the badge is always clickable when rendered */
.auth-badge[role="button"] { cursor: pointer; pointer-events: auto; }
.auth-badge--checking[role="button"], .auth-badge--verified[role="button"] { pointer-events: auto; }

/* ========== 5) CARD & STATUS =================================== */
.sp-card{
  position:relative; overflow:hidden;
  background:var(--sp-glass);
  border:1px solid var(--sp-border);
  border-radius:16px;
  padding:clamp(12px,2.2vw,20px);
  display:grid; gap:14px;
}
.sp-card::before{
  content:""; position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(60% 45% at 50% 50%, rgba(55,230,212,.08), transparent 65%);
  mix-blend-mode:screen; opacity:.0; animation: card-mist var(--pulse) var(--ease-breath) infinite;
}
@keyframes card-mist{ 0%,100%{ opacity:.03; transform: scale(1); } 50%{ opacity:.10; transform: scale(1.015); } }

.sp-status{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.sp-hash{ display:flex; gap:8px; align-items:baseline; }
.sp-hash-label{ color:var(--sp-dim); font-size:.9rem; }
.sp-hash-short{ font-family:var(--font-mono); }

/* ========== 6) BUTTONS & BUSY ================================== */
.sp-actions{ display:flex; gap:8px; flex-wrap:wrap; }

.btn-ghost,.btn-primary,.btn-secondary{
  --btn-bg: rgba(255,255,255,.03);
  position:relative; border-radius:12px; padding:12px 16px; min-height:44px;
  border:1px solid var(--sp-border); background:var(--btn-bg); color:var(--sp-text); font-weight:800;
  cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent; touch-action:manipulation;
  transition: transform .04s ease, box-shadow .18s ease, outline-color .18s ease, background .18s ease, opacity .12s ease;
}
.btn-primary{ --btn-bg: rgba(55,230,212,.10); box-shadow: 0 0 0 1px color-mix(in oklab, var(--crystal-accent), transparent 75%); }
.btn-secondary{ --btn-bg: rgba(92,225,255,.10); }
.btn-ghost:hover,.btn-primary:hover,.btn-secondary:hover{ outline:2px solid var(--sp-ring); box-shadow:0 6px 28px rgba(55,230,212,.08); }
.btn-ghost:active,.btn-primary:active,.btn-secondary:active{ transform: scale(var(--tap-scale)); }

/* Ripple feedback */
.btn-ghost:active::after,
.btn-primary:active::after,
.btn-secondary:active::after{
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background: radial-gradient(220px 120px at var(--x,50%) var(--y,50%), rgba(255,255,255,.18), transparent 60%);
  opacity:1; animation: ripple .45s ease-out forwards;
}
@keyframes ripple{ from { opacity:.35; } to { opacity:0; } }

/* Busy */
.btn-primary.is-busy,
.btn-primary[aria-busy="true"],
.btn-primary[data-busy="true"],
.btn-primary:disabled{ opacity:1; cursor:progress; }
.btn-primary.is-busy::after,
.btn-primary[aria-busy="true"]::after,
.btn-primary[data-busy="true"]::after,
.btn-primary:disabled::after{
  content:""; position:absolute; inset:1px; border-radius:inherit; pointer-events:none;
  background: var(--busy-stripes); mix-blend-mode: screen; opacity:.55; animation: stripes 1.1s linear infinite;
}
@keyframes stripes{ from{ background-position:0 0;} to{ background-position:140px 0;} }
.btn-primary.is-busy::before,
.btn-primary[aria-busy="true"]::before,
.btn-primary[data-busy="true"]::before,
.btn-primary:disabled::before{
  content:""; position:absolute; top:8px; right:10px; width:var(--spinner-size); height:var(--spinner-size);
  border-radius:50%; border:2px solid rgba(255,255,255,.2); border-top-color: var(--c-cyan);
  filter: drop-shadow(0 0 8px rgba(55,230,212,.6)); animation: spin .7s linear infinite;
}
@keyframes spin{ to { transform: rotate(360deg); } }
.btn-ghost.is-busy,.btn-ghost[aria-busy="true"],.btn-ghost[data-busy="true"],
.btn-secondary.is-busy,.btn-secondary[aria-busy="true"],.btn-secondary[data-busy="true"]{ opacity:.75; cursor:progress; }

/* ========== 7) SIGIL FRAME ===================================== */
.sp-frame{
  position:relative; display:grid; place-items:center;
  padding:clamp(8px,1.8vw,12px);
  border-radius:14px; border:1px solid var(--sp-border);
  background: radial-gradient(800px 600px at 50% 50%, rgba(0,255,222,.05), transparent 60%);
  overflow:hidden; transform: translateZ(0);
  animation: frame-breathe var(--pulse) var(--ease-breath) infinite;
}
@keyframes frame-breathe{ 0%,100%{ transform: scale(1); box-shadow: 0 0 0 rgba(55,230,212,0); } 50%{ transform: scale(1.012); box-shadow: 0 0 48px rgba(55,230,212,.06); } }
.sp-frame::after{
  content:""; position:absolute; inset:-5%;
  background: radial-gradient(40% 35% at 50% 50%, rgba(55,230,212,.12), transparent 70%);
  filter: blur(18px); opacity:.35; animation: halo var(--pulse) var(--ease-breath) infinite;
}
@keyframes halo{ 0%{ transform: scale(1); opacity:.28;} 50%{ transform: scale(1.06); opacity:.45;} 100%{ transform: scale(1); opacity:.28;} }

.sp-pulse-tag{ position:absolute; right:10px; bottom:10px; opacity:.9; font-size:.85rem; background: rgba(0,0,0,.4); padding:4px 8px; border-radius:8px; border:1px solid var(--sp-border); animation: tag-glint var(--pulse) linear infinite; }
@keyframes tag-glint{ 0%,100%{ box-shadow: 0 0 0 rgba(255,255,255,0);} 50%{ box-shadow: 0 0 12px rgba(92,225,255,.25) inset;} }

/* Skeleton / Error */
.sp-skeleton,.sp-error{ width:100%; min-height:220px; display:grid; place-items:center; }

/* Decorative runes (non-spinning) */
.sp-rune{ position:absolute; width:18px; height:18px; border:2px solid var(--sp-border); opacity:.7; }
.sp-rune--tl{ top:8px;  left:8px;  border-right:0; border-bottom:0; border-radius:8px 0 0 0; animation:rune var(--pulse) linear infinite; }
.sp-rune--tr{ top:8px;  right:8px; border-left:0; border-bottom:0; border-radius:0 8px 0 0; animation:rune calc(var(--pulse)*.85) linear infinite reverse; }
.sp-rune--bl{ bottom:8px;left:8px; border-right:0; border-top:0; border-radius:0 0 0 8px; animation:rune calc(var(--pulse)*1.15) linear infinite; }
.sp-rune--br{ bottom:8px;right:8px;border-left:0; border-top:0; border-radius:0 0 8px 0; animation:rune calc(var(--pulse)*1.3) linear infinite reverse; }
@keyframes rune{ 0%{ box-shadow: 0 0 0 rgba(55,230,212,0); opacity:.55; } 50%{ box-shadow: 0 0 14px rgba(55,230,212,.28); opacity:.95; } 100%{ box-shadow: 0 0 0 rgba(55,230,212,0); opacity:.55; } }

/* ========== 8) META & CTA ====================================== */
.sp-meta{ display:grid; gap:8px; }
.sp-meta-row{ display:grid; grid-template-columns:140px 1fr; gap:8px; align-items:start; }
.lbl{ color:var(--sp-dim); }
.mono{ font-family:var(--font-mono); }
.mono-wrap{ white-space:normal; word-break:break-word; overflow-wrap:anywhere; }
.sp-cta{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start; }

/* ========== 9) PROVENANCE ====================================== */
.sp-provenance{
  background:var(--sp-glass); border:1px solid var(--sp-border); border-radius:16px;
  padding:14px; display:grid; gap:10px; position:relative; overflow:hidden;
}
.sp-provenance::before{
  content:""; position:absolute; inset:-10%;
  background: radial-gradient(30% 22% at 10% 20%, rgba(92,225,255,.06), transparent 60%), radial-gradient(30% 22% at 90% 80%, rgba(167,139,250,.05), transparent 60%);
  mix-blend-mode:screen; opacity:.0; pointer-events:none; animation: panel-breathe var(--pulse) var(--ease-breath) infinite;
}
@keyframes panel-breathe{ 0%,100%{ opacity:.02; transform: scale(1);} 50%{ opacity:.08; transform: scale(1.01);} }
.sp-prov-title{ margin:0; font-size:1.05rem; }
.sp-prov-list{ list-style:none; padding:0; margin:0; display:grid; gap:12px; }
.sp-prov-row{ display:grid; grid-template-columns:120px 1fr; gap:8px; }

/* Fine print */
.sp-fine{ color:var(--sp-dim); font-size:.9rem; margin:6px 2px 0; }

/* ========== 10) OWNER-GATED LAYOUT ============================= */
.owner-gated{ display:none; margin-top:8px; }
.sigilpage[data-owner-verified="true"]:not([data-archived="true"]) .owner-gated{ display:block; }
.sigilpage[data-archived="true"] .owner-gated{ opacity:.5; pointer-events:none; }
.sigilpage[data-owner-verified="false"] .owner-gated{ display:none; }

/* Main | Sidebar grid */
.owner-gated > *{
  display:grid; grid-template-columns:1fr; gap:16px; align-items:start; min-width:0;
}
@media (min-width:980px){
  .owner-gated > *{ grid-template-columns:minmax(0,1fr) 360px; gap:20px; }
  .owner-gated > * > .sp-card:nth-of-type(1){ grid-column:1; }
  .owner-gated > * > .sp-card:nth-of-type(n+2){ grid-column:2; }
  .owner-gated > * > .sp-card:nth-of-type(n + 2) > .sp-card { margin-top:12px; }
}
/* Friendly behavior inside grid */
.owner-gated .sp-card{ position:relative; margin:0; min-width:0; overflow:hidden; }
.owner-gated .sp-card h3{ margin:0 0 10px; }
.owner-gated input, .owner-gated select, .owner-gated textarea, .owner-gated button{ max-width:100%; }
/* Nuke absolutely-positioned inner bits that cause overlap in small layouts */
.owner-gated [style*="position: absolute"]{ position: static !important; }

/* Panels + fields */
.sp-sovereign{ display:grid; gap:12px; }
.sp-panel{
  background:var(--sp-glass); border:1px solid var(--sp-border); border-radius:14px;
  padding:12px; display:grid; gap:10px; position:relative; overflow:hidden; z-index:2;
}
.sp-panel h3{ margin:0 0 4px; font-size:1rem; }
.sp-field{ display:grid; gap:8px; margin-block:10px; scroll-margin:20vh; }
.sp-field .lbl{ font-size:14px; opacity:.9; }

.sp-field input[type="text"],
.sp-field input[type="number"],
.sp-field select{
  width:100%; max-width:100%; min-height:48px; font-size:16px; line-height:1.2;
  border-radius:12px; border:1px solid var(--sp-border);
  background: rgba(255,255,255,.02); color:var(--sp-text);
  padding:12px 14px;
  outline:none; appearance:none; -webkit-appearance:none;
  -webkit-tap-highlight-color:transparent; touch-action:manipulation;
  transition: box-shadow .18s ease, border-color .18s ease, background .18s ease, transform .04s ease;
}
.sp-field input::placeholder{ color:rgba(255,255,255,.55); }
.sp-field input:focus, .sp-field select:focus{ box-shadow:0 0 0 2px var(--sp-ring); border-color:transparent; }

/* File input */
.sp-field input[type="file"]{
  width:100%; max-width:100%; padding:10px; border-radius:12px;
  border:1px solid var(--sp-border); background: rgba(255,255,255,.02); color:var(--sp-text);
  -webkit-tap-highlight-color:transparent; touch-action:manipulation;
}
.sp-field input[type="file"]::file-selector-button,
.sp-field input[type="file"]::-webkit-file-upload-button{
  margin-right:12px; padding:10px 14px; border-radius:10px; border:1px solid var(--sp-border);
  background: linear-gradient(180deg, rgba(55,230,212,.15), rgba(92,225,255,.12));
  color:var(--sp-text); font-weight:800; cursor:pointer; transition: transform .04s ease, box-shadow .18s ease;
}
.sp-field input[type="file"]::file-selector-button:hover,
.sp-field input[type="file"]::-webkit-file-upload-button:hover{ box-shadow:0 6px 28px rgba(55,230,212,.14); }
.sp-field input[type="file"]::file-selector-button:active,
.sp-field input[type="file"]::-webkit-file-upload-button:active{ transform: scale(var(--tap-scale)); }

/* Expiry numeric row */
.sp-expiry{ grid-template-columns:1fr 1fr 1fr; align-items:center; }
@media (max-width:768px){ .sp-expiry{ grid-template-columns:1fr 1fr; } }

/* Badges (generic) */
.badge{ padding:4px 8px; border-radius:999px; border:1px solid var(--sp-border); background:rgba(255,255,255,.03); }
.badge--ok{ color:var(--c-mint); box-shadow:0 0 0 1px var(--sp-ring) inset; }
.badge--checking{ background: linear-gradient(180deg, rgba(126,167,255,.22), rgba(0,0,0,.12)); }

/* Hide derived outputs in ownership panel */
.sigilpage .sp-panel[aria-labelledby="own-exp-title"] .sp-field:has(> output){ display:none !important; }
@supports not (selector(:has(*))){
  .sigilpage .sp-panel[aria-labelledby="own-exp-title"] .sp-field:not(.sp-expiry){ display:none !important; }
}


/* Ownership verify icon button */
.btn-icon{
  background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: 12px; padding: 8px; margin-left: 8px; cursor: pointer;
  box-shadow: 0 4px 14px rgba(0,0,0,0.35);
  transition: transform .2s ease, box-shadow .2s ease;
}
.btn-icon:hover{ transform: scale(1.08); box-shadow: 0 6px 18px rgba(0,255,208,0.35); }
.icon-verify-ownership{ stroke: var(--crystal-accent); transition: stroke .2s ease; }
.btn-icon:hover .icon-verify-ownership{ stroke:#fff; }
.ownership-overlay{ position: fixed; inset: 0; z-index: 9998; background: rgba(0,0,0,0.4); backdrop-filter: blur(3px); }

/* ========== 11) PRICE CHIP (LIVE / AVAILABLE) ================== */
/* φ now *breathes* (no spin). The conic stays static; glow + sheen breathe. */

/* removed spin variable; keep for fallback but unused */
/* @property --phi-angle { syntax: "<angle>"; initial-value: 0deg; inherits: false; } */

.sigilpage{ --phi-size:18px; --phi-outer-glow:18px; --phi-inner-glow:8px; }

.sp-price-chip{
  display: grid;
  grid-template-columns: auto auto 1fr auto; /* φ | price | spacer | badge */
  align-items: center;
  gap: 10px;
  min-height: 44px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid var(--sp-border);
  background: linear-gradient(180deg, rgba(18,24,26,.58), rgba(18,24,26,.36));
  -webkit-backdrop-filter: blur(8px) saturate(1.12); backdrop-filter: blur(8px) saturate(1.12);
  transition: background .25s ease, border-color .25s ease, box-shadow .25s ease;
  will-change: filter, box-shadow;
}

.sp-price-chip .phi{
  inline-size: var(--phi-size);
  block-size: var(--phi-size);
  position: relative;
  -webkit-mask: var(--phi-url) center/contain no-repeat;
          mask: var(--phi-url) center/contain no-repeat;
  background:
    conic-gradient(from 0deg,
      #ff5a5a 0deg, #ff964d 36deg, #ffe04d 72deg, #5aff77 108deg,
      #4df2ff 144deg, #6b6bff 180deg, #b84dff 216deg, #ff4dd0 252deg, #ff5a5a 360deg),
    linear-gradient(180deg, rgba(255,255,255,.28), rgba(255,255,255,.10));
  background-blend-mode: normal, screen;
  filter: saturate(150%) brightness(1.06)
          drop-shadow(0 0 calc(var(--phi-inner-glow)*.9) rgba(255,255,255,.55))
          drop-shadow(0 0 var(--phi-outer-glow) rgba(255,255,255,.35));
  animation: phiPulse var(--live-breath) ease-in-out infinite;
  will-change: filter, transform;
  isolation:isolate;
}
.sp-price-chip .phi::after{
  content:""; position:absolute; inset:-30%; pointer-events:none; border-radius:50%;
  background: radial-gradient(closest-side, rgba(255,255,255,.40), rgba(255,255,255,0) 70%);
  mix-blend-mode: screen; filter: blur(4px); opacity:.8; animation: phiHalo var(--live-breath) ease-in-out infinite;
}
.sp-price-chip .phi::before{
  content:""; position:absolute; inset:-8%; pointer-events:none; border-radius:40%;
  background: linear-gradient(115deg, transparent 0%, rgba(255,255,255,.35) 34%, rgba(255,255,255,.15) 40%, transparent 56%);
  mix-blend-mode: screen; filter: blur(.6px) saturate(140%); opacity:.75; animation: phiSheen calc(var(--live-breath) * 2.618) ease-in-out infinite;
}
.sp-price-chip .price{
  font-weight:900; font-variant-numeric: tabular-nums; white-space:nowrap; line-height:1; min-width:0;
  transition: color .25s ease, text-shadow .25s ease;
}
.sp-price-chip .chip-spacer{ min-width:8px; }
.sp-price-chip .live-badge{ justify-self:end; }

@keyframes phiPulse{ 0%,100%{ transform: scale(1); filter: saturate(140%) brightness(1.04); } 50%{ transform: scale(1.08); filter: saturate(185%) brightness(1.26); } }
@keyframes phiHalo{ 0%,100%{ opacity:.8; transform: scale(.97);} 50%{ opacity:1; transform: scale(1.06);} }
@keyframes phiSheen{ 0%{ transform: translateX(-8%) skewX(-6deg); opacity:.55;} 50%{ transform: translateX(10%) skewX(-6deg); opacity:.9;} 100%{ transform: translateX(22%) skewX(-6deg); opacity:.55;} }

/* Price chip flashes */
.sp-price-chip.flash-up{
  background: linear-gradient(180deg, rgba(36,230,162,.28), rgba(36,230,162,.10));
  border-color: rgba(36,230,162,.55);
  box-shadow: 0 0 22px rgba(36,230,162,.45), 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
}
.sp-price-chip.flash-up .price{ color:#24e6a2; text-shadow:0 0 12px rgba(36,230,162,.6); }

.sp-price-chip.flash-down{
  background: linear-gradient(180deg, rgba(255,64,64,.28), rgba(255,64,64,.10));
  border-color: rgba(255,64,64,.55);
  box-shadow: 0 0 22px rgba(255,64,64,.45), 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
}
.sp-price-chip.flash-down .price{ color:#ff4040; text-shadow:0 0 12px rgba(255,64,64,.6); }

/* LIVE badge (etheric) */
.sp-price-chip .live-badge{
  position:relative; display:inline-flex; align-items:center; gap:8px;
  padding:4px 12px 4px 22px; border-radius:999px; text-transform:uppercase; letter-spacing:.18em; font-weight:900;
  color:var(--ether-ice);
  background: linear-gradient(180deg, color-mix(in srgb, var(--ether-cyan) 28%, transparent), color-mix(in srgb, var(--ether-cyan) 12%, transparent));
  border:1px solid color-mix(in srgb, var(--ether-cyan) 70%, transparent);
  text-shadow: 0 0 6px color-mix(in srgb, var(--ether-cyan) 95%, transparent), 0 0 16px color-mix(in srgb, var(--ether-cyan) 75%, transparent), 0 0 28px color-mix(in srgb, var(--ether-deep) 55%, transparent);
  box-shadow: 0 0 20px color-mix(in srgb, var(--ether-cyan) 55%, transparent), inset 0 0 12px color-mix(in srgb, var(--ether-cyan) 28%, transparent), 0 0 1px rgba(255,255,255,.25);
  animation: liveGlow var(--live-breath) ease-in-out infinite; will-change: transform, filter, box-shadow, text-shadow; isolation:isolate;
}
.sp-price-chip .live-badge::before{ content: none !important; } /* dot removed */
.sp-price-chip .live-badge::after{
  content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
  background: linear-gradient(115deg, transparent 0%, rgba(255,255,255,.14) 22%, rgba(255,255,255,.34) 28%, rgba(255,255,255,.18) 36%, transparent 50%);
  mix-blend-mode: screen; filter: blur(.6px) saturate(140%); opacity:.8;
  transform: translate3d(-140%,0,0) skewX(-8deg); animation: liveBadgeGlint calc(var(--live-breath) * 1.15) linear infinite;
}
.sp-price-chip .live-badge .twinkles{
  position:absolute; inset:0; border-radius:inherit; pointer-events:none; mix-blend-mode: screen;
  background:
    radial-gradient(2px 2px at 20% 40%, rgba(255,255,255,.9), transparent 50%),
    radial-gradient(1.6px 1.6px at 72% 28%, rgba(255,255,255,.85), transparent 48%),
    radial-gradient(1.8px 1.8px at 55% 70%, rgba(255,255,255,.85), transparent 50%),
    radial-gradient(1.4px 1.4px at 36% 62%, rgba(255,255,255,.9), transparent 48%);
  filter: drop-shadow(0 0 6px color-mix(in srgb, var(--ether-cyan) 90%, transparent));
  opacity:.75; animation: twinkle var(--live-breath) ease-in-out infinite;
}
@keyframes liveGlow{
  0%{ transform: scale(.985); filter:saturate(120%) brightness(1.03); box-shadow:0 0 16px color-mix(in srgb, var(--ether-cyan) 42%, transparent), inset 0 0 8px color-mix(in srgb, var(--ether-cyan) 22%, transparent); }
  48%{ transform: scale(1.03); filter:saturate(175%) brightness(1.26); box-shadow: 0 0 30px color-mix(in srgb, var(--ether-cyan) 78%, transparent), inset 0 0 16px color-mix(in srgb, var(--ether-cyan) 36%, transparent); }
  52%{ transform: scale(1.031); filter:saturate(182%) brightness(1.28); }
  100%{ transform: scale(.985); filter:saturate(120%) brightness(1.03); box-shadow:0 0 16px color-mix(in srgb, var(--ether-cyan) 42%, transparent), inset 0 0 8px color-mix(in srgb, var(--ether-cyan) 22%, transparent); }
}
@keyframes liveBadgeGlint{ 0%{ transform: translate3d(-140%,0,0) skewX(-8deg); opacity:0; } 6%{ opacity:.55; } 50%{ opacity:.85; } 94%{ opacity:.55; } 100%{ transform: translate3d(140%,0,0) skewX(-8deg); opacity:0; } }
@keyframes twinkle{ 0%,100%{ opacity:.65; filter: brightness(1) saturate(1.1); transform: translateY(0) } 48%{ opacity:.95; filter: brightness(1.2) saturate(1.25); transform: translateY(-.5px) } 52%{ opacity:1; filter: brightness(1.3) saturate(1.35); transform: translateY(-.6px) } }

/* Wrap behavior for tiny screens */
@media (max-width:420px){
  .sp-price-chip{
    grid-template-columns: auto 1fr;   /* φ | price */
    grid-auto-rows: min-content;
  }
  .sp-price-chip .chip-spacer{ display:none; }
  .sp-price-chip .live-badge{ grid-column:1 / -1; margin-top:6px; justify-self:center; }
}

/* Touch-friendly sizing */
@media (pointer: coarse){
  .sp-price-chip{ padding: 12px 14px; }
  .sp-price-chip .live-badge{ padding: 6px 14px 6px 22px; }
}

/* ========== 12) DEBITS (LEDGER) ================================ */
.sigilpage .sp-debits{
  --pad: clamp(12px, 2.2vw, 20px);
  --gap: clamp(8px, 1.5vw, 14px);
  --ring: hsla(var(--crystal-hue,180),95%,62%,.28);
  --line-soft: rgba(255,255,255,0.08);
  padding:var(--pad); margin: clamp(8px, 1.6vh, 16px) 0 clamp(12px, 2vh, 20px);
  display:flex; flex-direction:column; gap:var(--gap);
}
.sigilpage .sp-debits__summary{ display:flex; flex-wrap:wrap; align-items:center; gap:clamp(8px,1.4vw,12px); margin-bottom: clamp(6px, 1vh, 10px); }
.sigilpage .auth-badge--debited{ background: linear-gradient(180deg, rgba(255,130,92,.22), rgba(0,0,0,.12)); border-color:rgba(255,180,150,.28); }
.sigilpage .auth-badge--available{ background: linear-gradient(180deg, rgba(52,248,186,.22), rgba(0,0,0,.12)); border-color:rgba(120,255,220,.28); }
.sigilpage .sp-debits h3{ margin:0; font-size:clamp(14px,2.4vw,18px); font-weight:700; letter-spacing:.01em; color:var(--c-ink,#eafcff); text-shadow:0 0 16px var(--ring); }

.sigilpage .sp-debits__list{
  --row-pad-y: clamp(8px, 1.4vw, 10px);
  --row-pad-x: clamp(10px, 2vw, 14px);
  margin:0; padding:0; list-style:none;
  max-height:min(40vh, 420px);
  overflow:auto; overscroll-behavior:contain; -webkit-overflow-scrolling:touch;
  border-top:1px solid var(--line-soft); border-bottom:1px solid var(--line-soft);
  border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
}
.sigilpage .sp-debits__item{
  position:relative; display:grid; grid-template-columns:1fr auto; align-items:start; gap:10px;
  padding: var(--row-pad-y) var(--row-pad-x); border-top:1px dashed var(--line-soft);
}
.sigilpage .sp-debits__item:first-child{ border-top-color:transparent; }
.sigilpage .sp-debits__who{ min-width:0; font-size:clamp(12px,2.1vw,14px); color:var(--c-ink,#eafcff); opacity:.95; }
.sigilpage .sp-debits__amt{ font-variant-numeric: tabular-nums; font-weight:800; font-size:clamp(12px,2.1vw,14px); justify-self:end; padding-left:12px; white-space:nowrap; color:var(--c-ink,#eafcff); text-shadow:0 0 12px var(--ring); }
.sigilpage .sp-debits__meta{ grid-column:1 / -1; font-size:clamp(11px,1.8vw,13px); opacity:.75; }
.sigilpage .sp-debits__item:not(:has(.sp-debits__amt)){ line-height:1.4; }
@media (min-width:640px){
  .sigilpage .sp-debits__item{ grid-template-columns:1.1fr minmax(120px,.9fr) auto; align-items:center; }
  .sigilpage .sp-debits__meta{ grid-column:auto; justify-self:start; opacity:.7; }
}
@media (max-width:520px){
  .sigilpage .sp-debits__item{ grid-template-columns:1fr; }
  .sigilpage .sp-debits__amt{ order:-1; justify-self:start; }
}
/* Scrollbar (WebKit) */
.sigilpage .sp-debits__list::-webkit-scrollbar{ height:10px; width:10px; }
.sigilpage .sp-debits__list::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(255,255,255,0.18), rgba(255,255,255,0.10));
  border-radius:999px; border:2px solid transparent; background-clip: padding-box;
}
.sigilpage .sp-debits__list::-webkit-scrollbar-track{ background:transparent; }

/* Abbr wrapping helpers */
.owner-gated abbr[title], .sp-debits abbr[title]{ text-decoration:none; border-bottom:0; font-variant-numeric:tabular-nums; word-break:break-all; }

/* ========== 13) STARGATE OVERLAY =============================== */
.stargate-overlay{
  position:fixed; inset:0; z-index:9999;
  background:radial-gradient(80% 60% at 50% 50%, rgba(0,0,0,.65), rgba(0,0,0,.95)), radial-gradient(1200px 800px at 50% 50%, rgba(126,167,255,.12), transparent 70%);
  display:grid; grid-template-rows:auto 1fr; gap:8px;
  backdrop-filter: blur(8px) saturate(1.2);
  animation: veil-breathe var(--pulse) var(--ease-breath) infinite;
}
.stargate-exit{
  align-self:start; justify-self:end; margin:8px;
  background:rgba(255,255,255,.1); border:1px solid var(--sp-border); color:var(--sp-text);
  border-radius:10px; padding:8px 10px; cursor:pointer; touch-action:manipulation;
  transition: transform .04s ease, box-shadow .18s ease;
}
.stargate-exit:active{ transform: scale(var(--tap-scale)); }
.stargate-stage{ display:grid; place-items:center; padding:10px; }
.stargate-stage img{ max-width:100vw; max-height:85vh; width:auto; height:auto; object-fit:contain; animation: frame-breathe var(--pulse) var(--ease-breath) infinite; }

/* ========== 14) ETERNAL PULSE PANEL ============================ */
.sp-epulse { margin: 16px 16px 4px; }
.epulse-card {
  position: relative;
  border-radius: 20px;
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 18px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08), 0 0 0 1px rgba(255,255,255,.03);
  padding: 18px 18px 16px; overflow: hidden;
}
.epulse-card::before {
  content:""; position:absolute; inset:-35% -35% auto auto; width:65%; height:140%;
  background: radial-gradient(600px 300px at 25% 10%, var(--ring), transparent 60%), radial-gradient(600px 300px at 85% 0%, var(--ring2), transparent 60%);
  filter: blur(42px); opacity:.35; pointer-events:none;
}
.epulse-head { display:flex; align-items:baseline; gap:12px; margin-bottom:10px; }
.epulse-label { font-weight:800; letter-spacing:.04em; text-transform:uppercase; color: var(--ink-dim); text-shadow: 0 0 18px color-mix(in oklab, var(--crystal-accent) 40%, transparent); }
.epulse-value { margin-left:auto; font-weight:900; font-size: clamp(22px, 4.6vw, 34px); line-height:1; color: var(--ink); text-shadow: 0 0 20px color-mix(in oklab, var(--crystal-accent) 55%, transparent), 0 0 8px color-mix(in oklab, var(--crystal-accent) 40%, transparent); }
.epulse-sub { margin-top:-2px; font-size:12.5px; color: var(--ink-dim); }
.epulse-bar { position:relative; margin-top:10px; height:12px; border-radius:999px; overflow:hidden; background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06)); border:1px solid rgba(255,255,255,0.16); }
.epulse-bar .bar-fill { height:100%; width:0%; background: linear-gradient(90deg, color-mix(in oklab, var(--crystal-accent) 85%, white 0%) 0%, color-mix(in oklab, var(--crystal-accent) 70%, white 0%) 100%); box-shadow: 0 0 16px color-mix(in oklab, var(--crystal-accent) 60%, transparent); border-right:1px solid rgba(255,255,255,0.35); transition: width .08s linear; }

/* ========== 15) LINEAGE UI ===================================== */
.sp-lineage {
  --accent: var(--crystal-accent, #00FFD0);
  --hue: var(--crystal-hue, 180);
  --breath: 5.236s; --breath-slow: calc(var(--breath) * 1.618); --breath-deep: calc(var(--breath) * 2.618); --breath-wide: calc(var(--breath) * 3.236);
  --glow: color-mix(in oklab, var(--accent) 70%, white 10%);
  --panel-bg: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  --border: 1px solid color-mix(in oklab, white 20%, transparent);

  position:relative; overflow:hidden; border:var(--border); background:var(--panel-bg); border-radius:18px;
  padding:14px 16px; margin:10px 0 18px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 22px -12px rgba(0,0,0,.6);
  backdrop-filter: blur(8px) saturate(115%); -webkit-backdrop-filter: blur(8px) saturate(115%); isolation:isolate;
  animation: lineage-breath var(--breath) ease-in-out infinite alternate, lineage-drift var(--breath-slow) ease-in-out infinite alternate-reverse;
}
.sp-lineage::before,
.sp-lineage::after{
  content:""; position:absolute; inset:-40%; z-index:0; pointer-events:none; mix-blend-mode:screen;
}
.sp-lineage::before{
  background:
    radial-gradient(60% 45% at 20% 30%, hsla(var(--hue) 90% 60% /.20), transparent 60%),
    radial-gradient(60% 45% at 80% 70%, hsla(calc(var(--hue) + 40) 90% 65% /.18), transparent 60%),
    radial-gradient(70% 60% at 50% 50%, hsla(calc(var(--hue) + 20) 90% 60% /.12), transparent 65%);
  filter: blur(28px) saturate(120%);
  animation: aurora-breath var(--breath-deep) ease-in-out infinite alternate, aurora-wander var(--breath-wide) ease-in-out infinite alternate;
  animation-delay: -1.618s, -0.382s;
}
.sp-lineage::after{
  background: conic-gradient(from 0deg, transparent 0 20deg, color-mix(in oklab, var(--glow), transparent 35%) 120deg, transparent 360deg);
  opacity:.35; animation: halo-swell var(--breath-slow) ease-in-out infinite alternate, halo-tilt var(--breath-deep) ease-in-out infinite alternate-reverse;
  transform-origin:50% 50%; will-change: transform, opacity, filter;
}
.sp-lineage > *{ position:relative; z-index:1; }

.sp-lineage__badge{ display:inline-flex; align-items:center; gap:.5ch; font-weight:800; letter-spacing:.14em; text-transform:uppercase; font-size:12px;
  background: linear-gradient(90deg, var(--accent), color-mix(in oklab, var(--accent) 60%, white 20%));
  -webkit-background-clip:text; background-clip:text; color:transparent;
  text-shadow: 0 0 .35em color-mix(in oklab, var(--accent) 40%, transparent), 0 0 .75em color-mix(in oklab, var(--accent) 25%, transparent);
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
}
.sp-lineage__trail{ display:flex; flex-wrap:wrap; align-items:center; gap:8px; margin-top:12px; }
.sp-lineage__segment{ display:contents; }

.sp-lineage__node{
  --chip-bg: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  display:inline-flex; align-items:center; gap:10px; padding:8px 12px; border-radius:9999px;
  border:1px dashed rgba(255,255,255,0.22); background:var(--chip-bg);
  backdrop-filter: blur(4px) saturate(120%); -webkit-backdrop-filter: blur(4px) saturate(120%);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 4px 16px -10px rgba(0,0,0,.6), 0 0 0 0 rgba(0,0,0,0);
  transform: translateZ(0); transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease;
  animation: node-breath var(--breath) ease-in-out infinite alternate, ember-glow var(--breath-slow) ease-in-out infinite alternate-reverse;
}
.sp-lineage__node:nth-child(3n+1){ animation-delay: -.382s, -1.236s; }
.sp-lineage__node:nth-child(3n+2){ animation-delay: -.618s, -.764s; }
.sp-lineage__node:nth-child(3n+3){ animation-delay: -1.000s, -.236s; }
.sp-lineage__node:hover{
  transform: translateY(-1px);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 6px 20px -10px color-mix(in oklab, var(--accent) 25%, black 75%), 0 0 24px -10px color-mix(in oklab, var(--accent) 45%, transparent);
}
.sp-lineage__node:active{ transform: translateY(0); }
.sp-lineage__node--parent{ border-style:solid; opacity:.98; box-shadow: inset 0 0 0 1px rgba(255,255,255,.10), 0 6px 18px -12px rgba(0,0,0,.7); }
.sp-lineage__node--this{
  border-color:var(--accent);
  background: radial-gradient(120% 140% at 10% 10%, color-mix(in oklab, var(--accent) 12%, transparent) 0 40%, transparent 70%), var(--chip-bg);
  box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 25%, white 5%), 0 0 0 1px rgba(0,0,0,.06) inset, 0 0 28px -10px color-mix(in oklab, var(--accent) 60%, transparent);
  animation: heart-fire var(--breath) ease-in-out infinite alternate, ember-glow var(--breath-slow) ease-in-out infinite alternate-reverse;
}

.sp-lineage__node .lbl{ font-size:11px; text-transform:uppercase; opacity:.8; letter-spacing:.08em; }
.sp-lineage__node .tok{ font-family:var(--font-mono); font-size:12px; opacity:.96; }
.sp-lineage__node .meta{ font-size:11px; opacity:.72; }

.sp-lineage__arrow{
  opacity:.7; padding:0 4px;
  filter: drop-shadow(0 0 6px color-mix(in oklab, var(--accent) 30%, transparent));
  background: linear-gradient(90deg, color-mix(in oklab, var(--accent) 60%, white 10%), color-mix(in oklab, var(--accent) 30%, transparent));
  -webkit-background-clip:text; background-clip:text; color:transparent;
  animation: arrow-sigh var(--breath-slow) ease-in-out infinite alternate;
}

.sp-lineage--children .sp-lineage__title{
  margin:10px 0 10px; font-size:14px; letter-spacing:.03em; text-transform:uppercase; opacity:.9;
  background: linear-gradient(90deg, #fff, color-mix(in oklab, var(--accent) 45%, #fff));
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.sp-lineage__children{ margin:0; padding:0; list-style:none; display:grid; gap:8px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
.sp-lineage__child{
  display:flex; flex-wrap:wrap; gap:10px; align-items:baseline; font-size:13.5px; padding:8px 10px;
  border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
  border:1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.05), 0 6px 16px -12px rgba(0,0,0,.65);
  transition: transform .25s ease, box-shadow .25s ease;
  animation: child-breath var(--breath) ease-in-out infinite alternate; animation-delay:-.618s;
}
.sp-lineage__child:hover{
  transform: translateY(-1px);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 10px 22px -12px color-mix(in oklab, var(--accent) 20%, black 80%);
}
.sp-lineage__child .pill{
  position:relative; font-size:10.5px; text-transform:uppercase; letter-spacing:.10em; padding:3px 10px; border-radius:9999px;
  border:1px solid rgba(255,255,255,0.18);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 0 10px -6px color-mix(in oklab, var(--accent) 50%, transparent);
  animation: pill-glow var(--breath-slow) ease-in-out infinite alternate;
}
.sp-lineage__child .pill::after{
  content:""; position:absolute; inset:0; border-radius:inherit;
  background: radial-gradient(120% 160% at 0% 0%, color-mix(in oklab, var(--accent) 30%, transparent), transparent 60%); opacity:.55; pointer-events:none;
}
.sp-lineage__child .tok{ font-family:var(--font-mono); opacity:.95; }
.sp-lineage__child .sep{ opacity:.55; }
.sp-lineage__child .amt{ opacity:.92; font-variant-numeric: tabular-nums; text-shadow: 0 0 .45em color-mix(in oklab, var(--accent) 25%, transparent); }
.sp-lineage__note{ margin-top:10px; font-size:12.5px; opacity:.78; line-height:1.5; text-wrap:balance; animation: note-float var(--breath-deep) ease-in-out infinite alternate; }

/* Motion cadences */
@keyframes lineage-breath{ 0%{ transform: translateY(0) scale(1); filter: saturate(115%);} 38.2%{ transform: translateY(-2px) scale(1.012); filter: saturate(128%);} 100%{ transform: translateY(0) scale(1); filter: saturate(115%);} }
@keyframes lineage-drift{ 0%{ filter: hue-rotate(0deg) brightness(1);} 100%{ filter: hue-rotate(8deg) brightness(1.03);} }
@keyframes aurora-breath{ 0%{ transform: scale(1.02) translate(-2%, -3%); opacity:.75; } 38.2%{ transform: scale(1.06) translate(2%, 1%);  opacity:.95; } 100%{ transform: scale(1.02) translate(-2%, -1%); opacity:.8; } }
@keyframes aurora-wander{ 0%{ transform: rotate(-1.5deg); } 100%{ transform: rotate(1.25deg); } }
@keyframes halo-swell{ 0%{ transform: scale(1); opacity:.28; filter: blur(8px);} 38.2%{ transform: scale(1.04); opacity:.40; filter: blur(10px);} 100%{ transform: scale(1.01); opacity:.33; filter: blur(9px);} }
@keyframes halo-tilt{ 0%{ transform: rotate(-2deg);} 100%{ transform: rotate(2deg);} }
@keyframes node-breath{ 0%{ transform: translateY(0) scale(1);} 38.2%{ transform: translateY(-1px) scale(1.006);} 100%{ transform: translateY(0) scale(1);} }
@keyframes ember-glow{ 0%{ box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 0 16px -14px color-mix(in oklab, var(--accent) 35%, transparent);} 100%{ box-shadow: inset 0 0 0 1px rgba(255,255,255,.10), 0 0 28px -12px color-mix(in oklab, var(--accent) 55%, transparent);} }
@keyframes heart-fire{
  0%{ box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 22%, white 4%), 0 0 0 1px rgba(0,0,0,.06) inset, 0 0 20px -10px color-mix(in oklab, var(--accent) 35%, transparent); }
  38.2%{ box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 38%, white 8%), 0 0 0 1px rgba(0,0,0,.06) inset, 0 0 40px -10px color-mix(in oklab, var(--accent) 72%, transparent); }
  100%{ box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 26%, white 6%), 0 0 0 1px rgba(0,0,0,.06) inset, 0 0 26px -10px color-mix(in oklab, var(--accent) 48%, transparent); }
}
@keyframes arrow-sigh{ 0%{ opacity:.55; transform: translateY(0);} 38.2%{ opacity:.85; transform: translateY(-1px);} 100%{ opacity:.65; transform: translateY(0);} }
@keyframes child-breath{ 0%{ transform: translateY(0) scale(1);} 38.2%{ transform: translateY(-1px) scale(1.004);} 100%{ transform: translateY(0) scale(1);} }
@keyframes pill-glow{ 0%{ box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 0 6px -6px color-mix(in oklab, var(--accent) 45%, transparent);} 100%{ box-shadow: inset 0 0 0 1px rgba(255,255,255,.10), 0 0 16px -8px color-mix(in oklab, var(--accent) 70%, transparent);} }
@keyframes note-float{ 0%{ transform: translateY(0); opacity:.78; } 38.2%{ transform: translateY(-1px); opacity:.88; } 100%{ transform: translateY(0); opacity:.80; } }

/* Responsive polish for lineage */
@media (max-width: 720px) {
  .sp-lineage { padding: 12px; border-radius: 16px; }
  .sp-lineage__trail { gap: 6px; }
  .sp-lineage__node { padding: 7px 10px; gap: 8px; }
  .sp-lineage__child { font-size: 13px; }
  .sp-lineage__children { grid-template-columns: 1fr; }
}

/* ========== 16) ACCESSIBILITY ================================== */
:focus-visible{ outline:2px solid var(--sp-ring); outline-offset:2px; }
@media (prefers-contrast: more){
  :focus-visible{ outline-width:3px; }
  .auth-badge, .btn-primary, .btn-secondary, .btn-ghost{ border-color:rgba(255,255,255,.22); }
}

/* Reduced motion safety */
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
  .sp-price-chip.flash-up,
  .sp-price-chip.flash-down{
    background:inherit; border-color:rgba(255,255,255,.16);
    box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
  }
}

/* ========== 17) MOBILE / TOUCH POLISH ========================== */
@media (max-width:768px){
  .sigilpage{ padding-top:8px; }
  .sp-status{ align-items:flex-start; }
  .sp-meta-row{ grid-template-columns:110px 1fr; }
  .sp-prov-row{ grid-template-columns:105px 1fr; }
  .sp-frame{ padding:10px; }
  .sp-card,.sp-provenance,.sp-sovereign,.sp-shell{ overflow:visible; }
}
@media (max-width:390px){
  .sp-price-chip{ bottom: calc(8px + var(--safe-bottom)); right: calc(8px + var(--safe-right)); font-size:12px; }
}
@media (pointer: coarse){
  .btn-ghost,.btn-primary,.btn-secondary{ min-height:54px; padding:14px 18px; font-size:16px; border-radius:14px; }
  .btn-icon{ min-width:44px; min-height:44px; padding:10px; border-radius:12px; }
  .sp-field input[type="text"],
  .sp-field input[type="number"],
  .sp-field select{ min-height:52px; font-size:17px; padding:14px 16px; } /* ≥16px prevents iOS zoom */
}

/* Number inputs: remove tiny steppers */
.sp-field input[type="number"]::-webkit-outer-spin-button,
.sp-field input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
.sp-field input[type="number"]{ -moz-appearance:textfield; }

/* Main stage padding tweak for phones */
@media (max-width: 480px){
  .sp-frame{ padding:12px; border-radius:16px; }
}
/* Subtle, tasteful flicker in your breath palette */
@keyframes chipUp {
  0%   { filter: saturate(1) brightness(1); transform: translateY(0); }
  40%  { filter: saturate(1.25) brightness(1.1); transform: translateY(-1px); }
  100% { filter: saturate(1) brightness(1); transform: translateY(0); }
}
@keyframes chipDown {
  0%   { filter: saturate(1) brightness(1); transform: translateY(0); }
  40%  { filter: saturate(0.9) brightness(0.95); transform: translateY(1px); }
  100% { filter: saturate(1) brightness(1); transform: translateY(0); }
}

/* Color hint via text-shadow so it works in light/dark without hardcoding fg */
.sp-price-chip.flash-up .price {
  text-shadow: 0 0 12px rgba(24, 255, 140, 0.55);
  animation: chipUp 420ms ease-out;
}
.sp-price-chip.flash-down .price {
  text-shadow: 0 0 12px rgba(255, 72, 72, 0.55);
  animation: chipDown 420ms ease-out;
}
/* ─────────────────────────────────────────────────────────────
   Kairos • Offline Verifier CTA
   Atlantean breath • Divine proportion • 5.236s rhythm
   ───────────────────────────────────────────────────────────── */

   .verifier-cta {
    --hue: var(--crystal-hue, 180);
    --accent: var(--crystal-accent, #37e6d4);
    --ink: #e7fbf7;
    --ink-dim: rgba(231, 251, 247, 0.72);
    --bgA: rgba(3, 10, 12, 0.85);
    --bgB: rgba(7, 20, 22, 0.82);
  
    --breath: 5.236s;
    --b-scale: 1;
    --b-bright: 0;
    --b-hue: 0deg;
  
    display: grid;
    grid-template-columns: minmax(260px, 1fr);
    gap: 12px;
    margin: 18px 0 10px;
  }
  
  @supports (background: paint(something)) or (offset: path('M0,0')) {
    @property --b-scale { syntax: "<number>"; inherits: true; initial-value: 1; }
    @property --b-bright { syntax: "<number>"; inherits: true; initial-value: 0; }
    @property --b-hue { syntax: "<angle>"; inherits: true; initial-value: 0deg; }
  }
  
  .verifier-btn {
    position: relative;
    display: grid;
    grid-template-columns: 42px 1fr;
    align-items: center;
    gap: 12px;
  
    padding: 14px 16px;
    border-radius: 18px;
    text-decoration: none;
    color: var(--ink);
    background:
      radial-gradient(120% 180% at -10% -30%,
        color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 56%), transparent 84%), transparent 62%)
      ,
      radial-gradient(120% 180% at 110% 130%,
        color-mix(in hsl, hsl(calc(var(--hue) - var(--b-hue)) 100% 56%), transparent 86%), transparent 62%)
      ,
      linear-gradient(180deg, var(--bgA), var(--bgB));
    background-size:
      calc(100% * var(--b-scale)) calc(100% * var(--b-scale)),
      calc(100% * var(--b-scale)) calc(100% * var(--b-scale)),
      100% 100%;
  
    box-shadow:
      0 1px 0 0 rgba(255,255,255,0.08) inset,
      0 18px 40px rgba(0,0,0,0.45),
      0 0 0 1px color-mix(in hsl, hsl(var(--hue) 100% 50%), transparent 74%);
  
    isolation: isolate;
    cursor: pointer;
    transform: translateZ(0);
    transition:
      transform .18s cubic-bezier(.2,.7,.2,1),
      box-shadow .25s ease,
      background-position .3s ease;
  
    animation:
      verifier-breathe var(--breath) ease-in-out infinite,
      verifier-drift calc(var(--breath) * 2) linear infinite;
  }
  
  .verifier-btn::before {
    /* soft aura ring */
    content: "";
    position: absolute;
    inset: -1px;
    border-radius: inherit;
    pointer-events: none;
    opacity: calc(.42 + .28 * var(--b-bright));
    filter: blur(calc(6px + 10px * var(--b-bright)));
    background:
      radial-gradient(160% 140% at 50% 0%,
        color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 64%), transparent 85%),
        transparent 60%),
      radial-gradient(160% 140% at 50% 100%,
        color-mix(in hsl, hsl(calc(var(--hue) - var(--b-hue)) 100% 62%), transparent 87%),
        transparent 62%);
    z-index: 0;
  }
  
  .verifier-btn:hover {
    transform: translateY(-1px) scale(1.01);
    box-shadow:
      0 1px 0 0 rgba(255,255,255,0.12) inset,
      0 22px 46px rgba(0,0,0,0.52),
      0 0 0 1px color-mix(in hsl, hsl(var(--hue) 100% 56%), transparent 68%),
      0 12px 28px color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 60%), transparent 80%);
  }
  
  .verifier-btn:active { transform: translateY(0) scale(.99); }
  
  .verifier-btn:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 3px;
  }
  
  /* Ghost (download) variant */
  .verifier-btn--ghost {
    background:
      linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,0.14),
      0 10px 24px rgba(0,0,0,0.36);
  }
  
  .verifier-btn--ghost .icon::after {
    opacity: .8;
  }
  
  /* Icon — Φ glyph orb (uses your /assets/phi.svg mask if provided) */
  .verifier-btn .icon {
    width: 42px;
    height: 42px;
    border-radius: 999px;
    position: relative;
    z-index: 1;
    display: grid;
    place-items: center;
    background:
      radial-gradient(60% 60% at 50% 35%, rgba(255,255,255,0.15), rgba(255,255,255,0) 70%),
      linear-gradient(180deg,
        color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 66%), #fff 8%),
        color-mix(in hsl, hsl(var(--hue) 100% 52%), #000 6%));
    box-shadow:
      0 0 0 1px rgba(255,255,255,0.10) inset,
      0 6px 14px color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 60%), transparent 72%);
  }
  
  .verifier-btn .icon::before {
    /* Φ mask */
    content: "";
    width: 62%;
    height: 62%;
    mask: var(--phi-url) center / contain no-repeat;
    -webkit-mask: var(--phi-url) center / contain no-repeat;
    background:
      linear-gradient(90deg,
        color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 72%), #fff 10%),
        #fff);
    filter: drop-shadow(0 0 calc(6px + 10px * var(--b-bright))
      color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 66%), transparent 60%));
  }
  
  .verifier-btn .icon.dl::before {
    /* subtle “download” tick beneath Φ */
    mask: none; -webkit-mask: none;
    width: 56%;
    height: 56%;
    background:
      conic-gradient(from 180deg,
        color-mix(in hsl, hsl(var(--hue) 100% 70%), transparent 30%) 0 120deg,
        transparent 0 360deg);
    border-radius: 999px;
  }
  .verifier-btn .icon.dl::after {
    content: "";
    position: absolute;
    bottom: 22%;
    left: 50%;
    width: 40%;
    height: 2px;
    transform: translateX(-50%);
    background: color-mix(in hsl, hsl(var(--hue) 100% 78%), #fff 20%);
    box-shadow: 0 0 14px color-mix(in hsl, hsl(var(--hue) 100% 72%), transparent 60%);
    opacity: .9;
  }
  
  /* Label */
  .verifier-btn .label {
    display: grid;
    gap: 2px;
    line-height: 1.15;
    z-index: 1;
  }
  .verifier-btn .label em {
    font-style: normal;
    font-weight: 700;
    letter-spacing: .2px;
    background: linear-gradient(90deg,
      color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 70%), #fff 12%),
      #fff);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 0 calc(10px + 10px * var(--b-bright))
      color-mix(in hsl, hsl(calc(var(--hue) + var(--b-hue)) 100% 65%), transparent 60%);
  }
  .verifier-btn .label small {
    font-size: 12px;
    color: var(--ink-dim);
    opacity: calc(.82 + .12 * var(--b-bright));
  }
  
  /* Motion — the breath */
  @keyframes verifier-breathe {
    0%, 100% {
      --b-scale: .985;
      --b-bright: .06;
      --b-hue: -6deg;
    }
    50% {
      --b-scale: 1.04;
      --b-bright: 1;
      --b-hue: 6deg;
    }
  }
  @keyframes verifier-drift {
    0%   { background-position:   0%   0%, 100% 100%, 0 0; }
    50%  { background-position: 2.2% -1%,  98% 101%, 0 0; }
    100% { background-position:   0%   0%, 100% 100%, 0 0; }
  }
  
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .verifier-btn { animation: none !important; }
    .verifier-btn::before { opacity: .35 !important; filter: blur(8px) !important; }
  }
  
  /* Light mode resilience */
  @media (prefers-color-scheme: light) {
    .verifier-cta {
      --ink: #062920;
      --ink-dim: rgba(6, 41, 32, 0.75);
      --bgA: rgba(248, 252, 255, 0.86);
      --bgB: rgba(235, 247, 250, 0.88);
    }
  }
  /* Mobile overlay fixes (Breath Proof, charts, etc.) */
.sp-breathproof__backdrop{
  position: fixed; inset: 0; z-index: 9999;
  background: color-mix(in oklab, #000 55%, transparent);
  display: grid; place-items: center;
  pointer-events: auto;
}
.sp-breathproof{
  max-width: min(92vw, 640px);
  width: 92vw;
  max-height: 86vh;
  overflow: auto;
  position: relative;
}
.sp-breathproof__close{
  position: absolute; top: 8px; right: 10px;
  font-size: 20px; line-height: 1;
}

/* Make all tappables feel instant on mobile */
.verifier-btn, .btn-ghost, .btn-primary, .sp-price-chip, .auth-badge, button {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* ========== 18) PROGRESS LINE & UTILITIES ====================== */
.sp-topline{
  position:fixed; top:0; left:0; height:3px; width:100%;
  background: linear-gradient(90deg, rgba(55,230,212,.0), rgba(55,230,212,.8), rgba(92,225,255,.0));
  box-shadow: 0 0 14px rgba(55,230,212,.6);
  transform: translateX(-100%);
  z-index:99999; pointer-events:none;
}
.sp-topline[data-show="true"]{ animation: sweep 1.1s linear infinite; }
@keyframes sweep{ 0%{ transform: translateX(-100%);} 100%{ transform: translateX(100%);} }

/* Utility */
.sr-only{
  position:absolute !important; height:1px; width:1px;
  overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap;
}
/* ================================================================
   MOBILE + TOUCH UPGRADE PACK (append at end of file)
   - Preserves your exact style; only improves tap size & ergonomics
   - Targets coarse pointers + small widths
================================================================ */

/* Smooth text sizing on mobile (prevents odd zoom behavior) */
html, body {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* Prevent "sticky hover" on touch devices while keeping focus styles */
@media (hover: none) and (pointer: coarse) {
  .btn-ghost:hover,
  .btn-primary:hover,
  .btn-secondary:hover,
  .auth-badge:hover,
  .sp-price-chip:hover,
  .stargate-exit:hover {
    box-shadow: none;
    outline: none;
  }
}

/* Global comfort on phones */
@media (max-width: 640px), (pointer: coarse) {
  .sp-shell { padding: clamp(14px, 4vw, 22px); }
  .sp-frame { padding: 12px; border-radius: 16px; }

  /* Core tap targets ≥ 56px high */
  .btn-ghost,
  .btn-primary,
  .btn-secondary,
  .auth-badge,
  .sp-price-chip,
  .stargate-exit {
    min-height: 56px;
    padding: 14px 18px;
    font-size: 17px; /* ≥16px prevents iOS zoom */
    border-radius: 16px;
  }

  /* Icon-sized controls → true 44×44 hit box */
  .btn-icon,
  .sp-breathproof__close {
    min-width: 44px;
    min-height: 44px;
    width: 44px;
    height: 44px;
    padding: 10px;
    border-radius: 12px;
    font-size: 22px;
  }

  /* Auth badge readability + target size */
  .auth-badge {
    padding: 14px 18px;
    font-size: 16.5px;
    border-radius: 18px;
  }

  /* Inputs: comfy, no zoom */
  .sp-field input[type="text"],
  .sp-field input[type="number"],
  .sp-field select {
    min-height: 52px;
    font-size: 17px; /* stops iOS zoom */
    padding: 14px 16px;
    border-radius: 14px;
  }

  /* Action rows: bigger gaps for thumbs */
  .sp-actions,
  .sp-breathproof__actions {
    gap: 10px;
  }

  /* Small chips & pills still easy to tap */
  .badge,
  .sp-lineage__child .pill {
    padding: 6px 12px;
    border-radius: 999px;
  }

  /* Meta rows tighten label column for phones */
  .sp-meta-row { grid-template-columns: 110px 1fr; }
  .sp-prov-row { grid-template-columns: 105px 1fr; }
}

/* Extra safe-area padding at the bottom so fixed/anchored bits never clash */
.sp-viewport {
  padding-bottom: calc(120px + var(--safe-bottom));
}

/* Overlays: ensure scrollable, centered, and finger-friendly */
.sp-breathproof__backdrop{
  position: fixed; inset: 0; z-index: 9999;
  background: color-mix(in oklab, #000 55%, transparent);
  display: grid; place-items: center;
  pointer-events: auto;
}

.sp-breathproof{
  max-width: min(92vw, 640px);
  width: 92vw;
  max-height: 86vh;
  overflow: auto;
  position: relative;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

.sp-breathproof__close{
  position: absolute; top: max(8px, env(safe-area-inset-top));
  right: max(10px, env(safe-area-inset-right));
}

/* Make all tappables feel instant on mobile */
.verifier-btn,
.btn-ghost,
.btn-primary,
.sp-price-chip,
.auth-badge,
button {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* Tiny screens: price chip layout stays readable */
@media (max-width: 420px) {
  .sp-price-chip{
    grid-template-columns: auto 1fr;
    grid-auto-rows: min-content;
  }
  .sp-price-chip .chip-spacer{ display:none; }
  .sp-price-chip .live-badge{
    grid-column: 1 / -1;
    margin-top: 6px;
    justify-self: center;
  }
}

/* Ledger list: better thumb scrolling */
.sigilpage .sp-debits__list{
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* Accessibility keeps priority on all devices */
:focus-visible {
  outline: 2px solid var(--sp-ring);
  outline-offset: 2px;
}
@media (prefers-contrast: more){
  :focus-visible{ outline-width: 3px; }
}
/* ==== Mobile popover/overlay reliability pack ==== */

/* A11y: one true "hidden" */
[hidden] { display: none !important; }

/* Overlays default inert; become interactive only when .is-open */
.sp-breathproof__backdrop,
.stargate-overlay,
.valuechart-backdrop,
.ownership-overlay,
.sp-modal {
  opacity: 0;
  pointer-events: none;
  transition: opacity .18s ease;
}
.sp-breathproof__backdrop.is-open,
.stargate-overlay.is-open,
.valuechart-backdrop.is-open,
.ownership-overlay.is-open,
.sp-modal.is-open {
  opacity: 1;
  pointer-events: auto;
}

/* Close buttons: always on top, always tappable */
.sp-breathproof__close,
.stargate-exit,
[data-modal-close] {
  z-index: 10003;             /* above panel chrome */
  pointer-events: auto !important;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* Make sure decorative layers never steal taps */
.sp-frame::after,
.sp-card::before,
.sp-title::after,
.sp-lineage::before,
.sp-lineage::after,
.sp-price-chip .phi::before,
.sp-price-chip .phi::after,
.verifier-btn::before {
  pointer-events: none !important;
}

/* Buttons always clickable even inside fancy containers */
.btn-ghost,
.btn-primary,
.btn-secondary,
[role="button"],
button {
  pointer-events: auto;
}

/* Body lock + neutralize transforms whenever any modal is open */
body.modal-open {
  overflow: hidden;
}
body.modal-open :where(.sigilpage, .sp-viewport, .sp-shell, .sp-veil, .sp-veil-stars) {
  transform: none !important;
  filter: none !important;
  perspective: none !important;
}

/* Hit-box comfort (keeps your look; improves touch affordance) */
@media (max-width: 640px), (pointer: coarse) {
  .sp-breathproof__close,
  .btn-icon { min-width:44px; min-height:44px; width:44px; height:44px; }
  .btn-ghost, .btn-primary, .btn-secondary, .auth-badge { min-height:56px; }
}

/* Safety: backdrops are interactive, panels scroll properly */
.sp-breathproof__backdrop,
.valuechart-backdrop,
.ownership-overlay {
  display: grid; place-items: center;
}
.sp-breathproof {
  position: relative;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

/* Ensure "send" isn’t blocked by any effects nearby */
.sp-actions { position: relative; z-index: 1; }
/* Mobile-first, colorless, tap-friendly styles for the Offline Verifier CTA */
/* Works with:
  <div class="verifier-cta">
    <button class="verifier-btn"> ... </button>
    <button class="verifier-btn verifier-btn--ghost"> ... </button>
  </div>
*/

/* Container: inline on desktop, stacks on phones */
.verifier-cta{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:stretch;

  /* Make taps register even if parent did odd things */
  position:relative;
  z-index:9999;
  pointer-events:auto;

  /* Prevent unexpected font zoom on iOS */
  -webkit-text-size-adjust:100%;
}

/* Buttons: large tap targets, no colors, inherit fonts */
.verifier-btn{
  -webkit-appearance:none;
  appearance:none;
  background:none;
  border:none;                 /* no color */
  border-radius:14px;

  /* Big, easy tap area */
  padding:14px 16px;
  min-height:48px;            /* recommended mobile minimum */
  min-width:44px;
  box-sizing:border-box;

  /* Layout */
  display:flex;
  align-items:center;
  gap:12px;
  flex:1 1 260px;             /* inline on wide screens, wraps when needed */

  /* Typography (no custom colors) */
  font:inherit;
  font-size:16px;             /* avoids iOS zoom-on-tap */
  line-height:1.2;

  /* Touch friendliness */
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout:none;
  touch-action:manipulation;
  user-select:none;
  pointer-events:auto;
  cursor:pointer;
}

/* Label block: vertical stack, no color */
.verifier-btn .label{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.verifier-btn .label em{
  font-style:normal;          /* rely on weight/semantics only */
  font-weight:600;
}
.verifier-btn .label small{
  font-size:.85rem;
  line-height:1.2;
}

/* Optional icon placeholder: sized only, no color */
.verifier-btn .icon{
  width:22px;
  height:22px;
  flex:0 0 22px;
  border-radius:6px;          /* shape only */
}

/* Accessibility feedback without custom colors */
.verifier-btn:focus{ outline:none; }
.verifier-btn:focus-visible{
  outline:auto;               /* uses UA/OS default focus color */
  outline-offset:2px;
}

/* Tactile feedback (no color) */
.verifier-btn:active{ transform:translateY(1px); }
@media (hover:hover){
  .verifier-btn:hover{ transform:translateY(-1px); }
}

/* Mobile: full-width single column */
@media (max-width:520px){
  .verifier-cta{ gap:10px; }
  .verifier-btn{
    flex:1 1 100%;
    width:100%;
  }
}

/* If some ancestor used pointer-events:none, ensure taps still work here */
.verifier-cta, .verifier-btn{ pointer-events:auto; }
/* ====== Mobile-first ergonomics (no colors) ====== */
.owner-gated {
  position: relative;
  -webkit-text-size-adjust: 100%;
  touch-action: manipulation;
}

/* Large, consistent tap targets (prevents iOS zoom-on-focus) */
.owner-gated input,
.owner-gated select,
.owner-gated button {
  font: inherit;
  font-size: 16px;            /* ≥16px avoids iOS zoom */
  line-height: 1.25;
  min-height: 48px;           /* recommended mobile tap size */
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  touch-action: manipulation;
  user-select: none;
}

/* Make number fields behave on mobile (no spin buttons, no wheel changes) */
.owner-gated input[type="number"]::-webkit-outer-spin-button,
.owner-gated input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.owner-gated input[type="number"] { -moz-appearance: textfield; }

/* Inputs & selects: comfortable padding without styling colors */
.owner-gated .btn-ghost,
.owner-gated input,
.owner-gated select {
  padding: 12px 14px;
  border-radius: 12px;
  width: 100%;
}

/* Primary button: bigger hit area even if label is just an emoji */
.owner-gated .btn-primary {
  padding: 12px 16px;
  min-width: 56px;
  border-radius: 14px;
  cursor: pointer;
}
.owner-gated .btn-primary:disabled {
  cursor: default;
  opacity: .65;               /* no color usage, just opacity */
  pointer-events: none;
}

/* Keyboard visibility without custom colors */
.owner-gated :focus { outline: none; }
.owner-gated :focus-visible { outline: auto; outline-offset: 2px; }

/* ====== Responsive layout ====== */

/* Hook lets CSS override inline grid columns on phones */
.owner-grid {
  display: grid;
  gap: 12px;
  align-items: center;
}

/* Phone-first: stack inputs, full-width controls */
@media (max-width: 640px) {
  .owner-grid { grid-template-columns: 1fr !important; }

  /* Buttons & fields span full width */
  .owner-gated .btn-primary,
  .owner-gated .btn-ghost,
  .owner-gated input,
  .owner-gated select { width: 100%; }

  /* Action row wraps so text sits under the button */
  .owner-actions {
    flex-wrap: wrap;
    align-items: flex-start;
  }
  .owner-actions > .btn-primary { flex: 0 0 auto; }
  .owner-actions > div { flex: 1 1 100%; min-width: 0; }
}

/* Larger screens: keep your original three-column grid */
@media (min-width: 641px) {
  .owner-grid {
    grid-template-columns:
      minmax(120px,180px)
      minmax(120px,160px)
      minmax(120px,160px);
  }
}

/* Coarse pointers (most touch devices): give a little extra space */
@media (pointer: coarse) {
  .owner-gated input,
  .owner-gated select,
  .owner-gated button { min-height: 50px; }
}

/* Prevent accidental overlay issues blocking taps */
.owner-gated, .owner-gated * { pointer-events: auto; }

/* Gentle tactile feedback without colors */
.owner-gated button:active { transform: translateY(1px); }
@media (hover:hover) {
  .owner-gated button:hover { transform: translateY(-1px); }
}
