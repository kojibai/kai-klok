/* VerifierStamper.css
   Atlantean Tech Theme — Mobile-first, zero horizontal overflow
   Palette harmonized with SigilModal/SealMoment (seal tokens respected)
   Drop-in, production-ready
*/


/* ───────────────────────────────────────────────────────────────
   0) Reset + base
──────────────────────────────────────────────────────────────── */
*,
*::before,
*::after { box-sizing: border-box; }

html, body {
  background: radial-gradient(1200px 800px at 10% 0%, #0b0f2a 0%, #05060a 55%) fixed;
  color: var(--ink);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
  margin: 0;
  overflow-x: hidden; /* global guard */
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  min-height: 100dvh;
  touch-action: pan-y;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ───────────────────────────────────────────────────────────────
   1) Theme tokens — holo ink + SealMoment harmonization
   - Uses --seal-* when present; otherwise sensible fallbacks.
──────────────────────────────────────────────────────────────── */
:root{
  /* SealMoment-aware palette (fallbacks preserve prior look) */
  --seal-text: #e8fbf8;
  --seal-text-dim: #aee8df;
  --seal-core: #37ffe4;      /* primary aqua */
  --seal-aura: #11d7ff;      /* secondary cyan */
  --seal-accent-2: #a78bfa;  /* violet */
  --seal-accent-3: #5ce1ff;  /* sky */

  /* Base ink & surfaces */
  --bg: #05060a;
  --card: rgba(16, 18, 28, 0.66);
  --glass: rgba(18, 22, 34, 0.72);
  --border: rgba(255, 255, 255, 0.08);
  --ink: var(--seal-text, #e8ecff);
  --ink-dim: color-mix(in srgb, var(--seal-text-dim, #aab1d4) 92%, #90a7c2 8%);

  /* Accents derive from seal hues */
  --accent:   color-mix(in srgb, var(--seal-core, #78f7ff) 100%, transparent);
  --accent-2: color-mix(in srgb, var(--seal-accent-2, #b98bff) 100%, transparent);
  --accent-3: color-mix(in srgb, var(--seal-accent-3, #4cffb3) 100%, transparent);

  /* States */
  --error: #ff6b7a;
  --warn: #ffd166;
  --ok: #4ee89a;

  /* Depth + radii */
  --shadow: 0 6px 24px rgba(0,0,0,0.45), inset 0 0 0 1px var(--border);
  --radius: 14px;
  --radius-lg: 24px;
  --pill: 999px;

  /* Layout scales */
  --page-pad: clamp(10px, 4vw, 16px);
  --modal-pad: clamp(10px, 3.5vw, 16px);
  --topbar-h: 48px;

  /* Kai pulse for synced animations (ms) */
  --kai-pulse: 5236ms;
}

@media (prefers-color-scheme: light) {
  :root {
    --bg: #f7f8ff;
    --card: rgba(255,255,255,0.8);
    --glass: rgba(255,255,255,0.85);
    --ink: #0d1330;
    --ink-dim: #4a527d;
    --border: rgba(13,19,48,0.08);
    --shadow: 0 6px 24px rgba(8,16,40,0.12), inset 0 0 0 1px var(--border);
  }
}

/* ───────────────────────────────────────────────────────────────
   2) Page shell
──────────────────────────────────────────────────────────────── */
.verifier-stamper {
  max-width: 1100px;
  margin: 24px auto 64px;
  padding-inline: var(--page-pad);
  width: 100%;
  overflow: clip;
}

/* ───────────────────────────────────────────────────────────────
   3) Toolbar (sticky, wraps on tiny widths)
──────────────────────────────────────────────────────────────── */
.toolbar {
  position: sticky;
  top: 0;
  z-index: 30;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin: 0 0 18px;
  padding: 10px 12px;
  background: linear-gradient(180deg, rgba(10,12,20,0.65), rgba(10,12,20,0.25));
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  max-width: 100%;
}
.brand-lockup { display: flex; align-items: center; gap: 12px; min-width: 0; }
.brand-lockup .glyph {
  width: 28px; height: 28px; border-radius: 6px;
  background: conic-gradient(from 0deg at 50% 50%, var(--accent), var(--accent-2), var(--accent-3), var(--accent));
  box-shadow: 0 0 24px color-mix(in srgb, var(--accent) 35%, transparent);
}
.toolbar h1{
  margin: 0; line-height: 1.05; font-weight: 800; text-transform: uppercase; letter-spacing: 0.08em;
  font-size: clamp(18px, 1.4vw + 0.8rem, 26px);
  color: transparent;
  background:
    conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2), var(--accent-3), var(--accent)),
    radial-gradient(120% 180% at 10% 0%, color-mix(in srgb, var(--accent) 35%, transparent), transparent 60%);
  -webkit-background-clip: text; background-clip: text;
  -webkit-text-stroke: 0.55px rgba(255,255,255,.28);
  text-shadow: 0 0 .5px rgba(255,255,255,.35), 0 6px 22px color-mix(in srgb, var(--accent) 26%, transparent);
  background-size: 200% 200%;
  animation: holoShift 14s linear infinite;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.toolbar h1::after{
  content:""; display:block; height:1px; width:52%; margin-top:4px;
  background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--accent) 60%, transparent), color-mix(in srgb, var(--accent-2) 50%, transparent), transparent);
  filter: blur(.25px); opacity:.7;
}
@keyframes holoShift { 0%{background-position:0% 50%} 100%{background-position:200% 50%} }
@media (prefers-reduced-motion: reduce) { .toolbar h1 { animation: none; } }

.toolbar-actions{
  display: flex; align-items: center; gap: clamp(8px, 1.2vw, 14px);
  flex-wrap: wrap; padding: 6px; border-radius: var(--pill);
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)),
    radial-gradient(120% 180% at 80% -20%, color-mix(in srgb, var(--accent) 14%, transparent), transparent 60%);
  border: 1px solid rgba(255,255,255,.08);
  -webkit-backdrop-filter: blur(10px) saturate(1.15);
  backdrop-filter: blur(10px) saturate(1.15);
  box-shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
}
.toolbar-actions > *{
  white-space: nowrap; height: 38px; display: inline-flex; align-items: center; gap: 8px;
  border-radius: 999px; box-shadow: none; max-width: 100%;
}

/* ───────────────────────────────────────────────────────────────
   4) Buttons
──────────────────────────────────────────────────────────────── */
button{
  appearance: none; border: none; cursor: pointer; color: var(--ink); background: transparent;
  font-weight: 600; border-radius: 10px; padding: 10px 14px;
  transition: transform .08s ease, box-shadow .2s ease, background .2s ease, filter .2s ease;
  user-select: none; -webkit-user-select: none;
}
button:active { transform: translateY(1px) }
button:focus-visible { outline: 2px solid color-mix(in srgb, var(--accent) 65%, transparent); outline-offset: 2px; }

button.primary{
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 92%, white 0%), color-mix(in srgb, var(--accent) 70%, white 0%) 40%, color-mix(in srgb, var(--accent-2) 70%, white 0%) 100%);
  color: #06121a; text-shadow: 0 1px 0 rgba(255,255,255,.35); box-shadow: 0 6px 16px color-mix(in srgb, var(--accent) 35%, transparent);
  padding-inline: 14px;
}
button.primary:hover{ box-shadow: 0 10px 22px color-mix(in srgb, var(--accent) 45%, transparent); filter: brightness(1.05); }

button.secondary{
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) .16, transparent), color-mix(in srgb, var(--accent-2) .14, transparent));
  border: 1px solid color-mix(in srgb, var(--accent) 35%, transparent);
  color: var(--ink); padding-inline: 14px;
}
button.secondary:hover{ background: color-mix(in srgb, var(--accent) .18, transparent); filter: brightness(1.05); }

/* ───────────────────────────────────────────────────────────────
   5) Verifier dialog base
──────────────────────────────────────────────────────────────── */
dialog.glass-modal{
  box-sizing: border-box;
  inline-size: min(1000px, calc(100vw - (var(--modal-pad) * 2)));
  max-inline-size: calc(100vw - (var(--modal-pad) * 2));
  max-height: calc(100vh - 2 * clamp(8px, 6vh, 24px));
  margin-block: clamp(8px, 6vh, 24px);
  margin-inline: auto;
  border: 0; padding: 0; border-radius: var(--radius-lg);
  background: linear-gradient(180deg, var(--glass), rgba(10,12,20,0.7));
  box-shadow: 0 24px 64px rgba(0,0,0,0.5), inset 0 0 0 1px var(--border);
  color: var(--ink);
  overflow: hidden;
}
dialog.glass-modal::backdrop{
  background:
    radial-gradient(900px 600px at 80% -10%, color-mix(in srgb, var(--accent) 25%, transparent), transparent 40%),
    radial-gradient(900px 600px at 10% 110%, color-mix(in srgb, var(--accent-2) 18%, transparent), transparent 40%),
    rgba(0,0,10,0.55);
  -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
}
dialog.glass-modal.fullscreen[data-open="true"]{ animation: pop-in .18s ease-out; }
@keyframes pop-in { from{ transform: translateY(6px) scale(0.98); opacity: 0; } to{ transform: translateY(0) scale(1); opacity: 1; } }
@supports (width: 100dvw){
  dialog.glass-modal{
    inline-size: min(1000px, calc(100dvw - (var(--modal-pad) * 2)));
    max-inline-size: calc(100dvw - (var(--modal-pad) * 2));
    max-height: calc(100dvh - 2 * clamp(8px, 6vh, 24px));
  }
}

.modal-viewport{ display:flex; flex-direction:column; width:100%; height:100%; max-width:100%; overflow:hidden; }

.modal-topbar{
  position: sticky; top: 0; z-index: 2; min-height: var(--topbar-h);
  display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px;
  background: linear-gradient(180deg, rgba(10,12,20,0.9), rgba(10,12,20,0.7));
  border-bottom: 1px solid var(--border);
}

.close-btn{
  margin: 6px 8px; width: 36px; height: 36px; border-radius: 10px;
  background: rgba(255,255,255,0.06); border: 1px solid var(--border);
  font-size: 20px; line-height: 1;
}
.close-btn:hover{ background-color: rgba(255,255,255,0.08); }

/* Status strip */
.status-strip{
  display:flex; gap:8px; padding:8px 8px 8px 0; overflow-x:auto; white-space:nowrap; scrollbar-width:none;
  scroll-snap-type: x proximity;
}
.status-strip::-webkit-scrollbar{ display:none }
.status-strip > *{ scroll-snap-align:start }

.chip{
  display:inline-flex; align-items:center; border-radius:999px; padding:6px 10px;
  font-size:12px; letter-spacing:.02em; border:1px solid var(--border); background: rgba(255,255,255,0.04); color: var(--ink);
}
.chip.info{ border-color: color-mix(in srgb, var(--accent) 25%, transparent); color: var(--accent) }
.chip.ok  { border-color: rgba(78,232,154,0.35); color: var(--ok) }
.chip.warn{ border-color: rgba(255,209,102,0.35); color: var(--warn) }
.chip.err { border-color: rgba(255,107,122,0.4); color: var(--error) }

/* Header */
.modal-header{
  display:grid; grid-template-columns:auto 1fr; gap:14px; padding:12px 16px; align-items:center;
}
.modal-header img{
  width:64px; height:64px; border-radius:10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.35), inset 0 0 0 1px var(--border);
  background: radial-gradient(80% 80% at 50% 30%, color-mix(in srgb, var(--accent) 25%, transparent), transparent);
}
.header-fields{ min-width:0 }
.header-fields h2{ margin:0 0 4px; font-size:18px; overflow-wrap:anywhere }
.header-fields p{ margin:0; color: var(--ink-dim) }
.header-fields span{ overflow-wrap:anywhere }
.header-keys{
  margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;
}
.header-keys .field{
  background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius:10px; padding:6px 8px;
}
.header-keys .field.warn{ color: var(--warn); border-color: rgba(255,209,102,0.35) }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace }

/* FABs (optional quick actions) */
.fab-stack{
  position:absolute; right: clamp(8px, 4vw, 16px); top: 82px;
  display:flex; flex-direction:column; gap:10px; z-index:3; will-change: transform; transform: translateZ(0);
}
.fab{
  width:44px; height:44px; border-radius:12px;
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 20%, transparent), color-mix(in srgb, var(--accent-2) 22%, transparent));
  border: 1px solid var(--border); box-shadow: var(--shadow); font-weight: 700;
  -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
}
.fab.copied{ outline: 2px solid var(--ok) }

/* Tabs */
.tabs{
  display:flex; gap:8px; padding:8px 12px 12px; border-top:1px solid var(--border); border-bottom:1px solid var(--border);
  position: sticky; top: var(--topbar-h); z-index:1;
  background: linear-gradient(180deg, rgba(10,12,20,0.85), rgba(10,12,20,0.65));
}
.tabs button{
  padding:8px 12px; border-radius: var(--pill); color: var(--ink-dim); border:1px solid transparent;
}
.tabs button:hover{ color: var(--ink) }
.tabs button.active{
  color: #06121a;
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 100%, white 0%), color-mix(in srgb, var(--accent-2) 80%, white 0%));
  border-color: transparent;
}

/* Body (scrollable, never overflow X) */
.modal-body{
  padding: 14px 16px 6px;
  overflow-y: auto; overflow-x: hidden;
  max-height: calc(90vh - 260px);
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  content-visibility: auto;
  contain: layout paint style;
  contain-intrinsic-size: 800px 600px;
}
@supports (height: 100dvh){ .modal-body{ max-height: calc(100dvh - 260px) } }

/* Summary grid */
.summary-grid{
  display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px;
}
.summary-grid .kv{
  display:grid; grid-template-columns: 120px 1fr; gap:8px; padding:10px 12px;
  border-radius: var(--radius); background: var(--card); border: 1px solid var(--border); min-width:0;
}
.summary-grid .kv.wide{ grid-column: 1 / -1 }
.kv .k{ color: var(--ink-dim) }
.kv .v{ color: var(--ink); overflow-wrap:anywhere }

/* Lineage */
.lineage .empty{ margin:8px 4px; color: var(--ink-dim) }
.transfers{ list-style:none; margin:0; padding:0; display:grid; gap:10px }
.transfer{
  border: 1px solid var(--border); border-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.02));
  padding: 10px 12px;
}
.transfer header{ display:flex; align-items:center; gap:8px; margin-bottom:6px }
.transfer .index{ font-weight:700; color: var(--ink) }
.transfer .state.open{ color: var(--warn) }
.transfer .state.closed{ color: var(--ok) }
.transfer .row{
  display:grid; grid-template-columns: 140px 1fr; gap:8px; padding:4px 0; border-top:1px dashed var(--border);
}
.transfer .row:first-of-type{ border-top:0 }
.transfer .row .v{ overflow-wrap:anywhere }
.payload summary{ cursor:pointer; color: var(--accent) }
.payload .row{ grid-template-columns: 100px 1fr }

/* Data view */
.json-toggle{ margin: 8px 0 12px; color: var(--ink-dim) }
.raw-json{
  white-space: pre-wrap; padding:12px; border-radius: var(--radius);
  background:#0d1020; border:1px solid var(--border);
  max-height: 46vh; overflow:auto;
}
.json-tree-wrap{ overflow-x: hidden }
.json-node{ list-style:none; padding-left:14px }
.json-node > li > details > summary{ cursor:pointer; color: var(--accent-2) }

/* Footer */
.modal-footer{
  display:flex; gap:10px; justify-content:space-between; align-items:center;
  padding: 12px 16px 14px; border-top:1px solid var(--border);
  background: linear-gradient(0deg, color-mix(in srgb, var(--accent) 5%, transparent), transparent 40%), transparent;
}
.modal-footer .status.error{ color: var(--error) }

/* ───────────────────────────────────────────────────────────────
   6) Explorer Dialog (full-screen mobile, side-sheet desktop)
──────────────────────────────────────────────────────────────── */
.explorer-dialog{
  box-sizing:border-box; width:100vw; max-width:100vw; height:100dvh; max-height:100dvh;
  margin:0; padding:0; border:0; color: var(--ink);
  background: linear-gradient(180deg, var(--glass), rgba(10,12,20,0.7));
  box-shadow: 0 24px 64px rgba(0,0,0,0.5), inset 0 0 0 1px var(--border);
  overflow: hidden; border-radius:0;
}
.explorer-dialog::backdrop{
  background:
    radial-gradient(900px 600px at 70% -10%, color-mix(in srgb, var(--accent) 25%, transparent), transparent 40%),
    radial-gradient(900px 600px at 15% 110%, color-mix(in srgb, var(--accent-2) 18%, transparent), transparent 40%),
    rgba(0,0,10,0.55);
  -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
}
.explorer-chrome{ display:flex; flex-direction:column; height:100%; max-width:100%; overflow:hidden }
.explorer-topbar{
  display:grid; grid-template-columns:auto 1fr; align-items:center; gap:8px;
  padding:8px 10px; border-bottom:1px solid var(--border);
  background: linear-gradient(180deg, rgba(10,12,20,0.9), rgba(10,12,20,0.7));
}
.explorer-title{
  margin:0; font-size:16px; font-weight:700; letter-spacing:.06em; text-transform:uppercase;
  color: transparent;
  background:
    conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2), var(--accent-3), var(--accent)),
    radial-gradient(120% 180% at 10% 0%, color-mix(in srgb, var(--accent) 35%, transparent), transparent 60%);
  -webkit-background-clip: text; background-clip: text;
  -webkit-text-stroke: 0.55px rgba(255,255,255,.28);
  text-shadow: 0 0 .5px rgba(255,255,255,.35), 0 6px 22px color-mix(in srgb, var(--accent) 26%, transparent);
  background-size: 200% 200%;
  animation: holoShift 14s linear infinite;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
@media (prefers-reduced-motion: reduce){ .explorer-title{ animation:none } }

.explorer-body{
  flex:1 1 auto; min-height:0; overflow-y:auto; overflow-x:hidden; padding:10px 12px 16px;
  -webkit-overflow-scrolling: touch; overscroll-behavior: contain;
  content-visibility: auto; contain: layout paint style; contain-intrinsic-size: 800px 600px;
}

@media (min-width: 960px){
  .explorer-dialog{
    width: clamp(380px, 34vw, 520px); height: 100dvh; margin: 0 0 0 auto; border-radius: 20px 0 0 20px;
  }
}

/* ───────────────────────────────────────────────────────────────
   7) Keystream (2-line on mobile, expand on hover desktop)
──────────────────────────────────────────────────────────────── */
.keystream,
[data-keystream],
[data-role="keystream"]{
  font-size: clamp(12px, 2.8vw, 14px); line-height: 1.15; letter-spacing: .02em; color: var(--ink);
  white-space: normal; word-break: break-word; overflow-wrap: anywhere; text-overflow: clip;
  max-height: calc(2 * 1.15em + 2px); padding-right: 2px;
  -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 85%, rgba(0,0,0,0.25));
          mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 85%, rgba(0,0,0,0.25));
}
@media (hover: none) and (pointer: coarse){
  .keystream,[data-keystream],[data-role="keystream"]{
    overflow-y:auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; scroll-behavior: auto;
  }
  .keystream::-webkit-scrollbar,[data-keystream]::-webkit-scrollbar,[data-role="keystream"]::-webkit-scrollbar{ display:none }
}
@media (hover: hover){
  .keystream:hover, .keystream:focus,
  [data-keystream]:hover, [data-keystream]:focus,
  [data-role="keystream"]:hover, [data-role="keystream"]:focus{
    max-height:none; -webkit-mask-image:none; mask-image:none;
  }
}

/* ───────────────────────────────────────────────────────────────
   8) Holo titles for small Verify and Explorer headings
──────────────────────────────────────────────────────────────── */
.toolbar .brand-lockup h3{
  margin:0; color:transparent;
  background:
    conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2), var(--accent-3), var(--accent)),
    radial-gradient(120% 180% at 10% 0%, color-mix(in srgb, var(--accent) 35%, transparent), transparent 60%);
  -webkit-background-clip: text; background-clip:text;
  -webkit-text-stroke: 0.55px rgba(255,255,255,.28);
  text-shadow: 0 0 .5px rgba(255,255,255,.35), 0 6px 22px color-mix(in srgb, var(--accent) 26%, transparent);
  background-size: 200% 200%; animation: holoShift 14s linear infinite;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
@media (prefers-reduced-motion: reduce){ .toolbar .brand-lockup h3{ animation:none } }

/* ───────────────────────────────────────────────────────────────
   Atlantean Iridescent Close “×” — v3.2 (mobile-first, no-jank)
   Works for: .modal-topbar .close-btn, .explorer-topbar .close-btn
   - 44px+ tap target on touch
   - focus-visible halo (WCAG AA)
   - reduced-motion & forced-colors support
   - GPU-friendly transforms only
──────────────────────────────────────────────────────────────── */

/* Defaults (safe fallbacks if your theme vars aren’t present) */
:root{
  --accent:       #11d7ff;
  --accent-2:     #7a5cff;
  --accent-3:     #00ffe0;
  --border:       rgba(255,255,255,.14);
  --x-size:       40px;          /* base button box (desktop) */
  --x-radius:     12px;
  --x-gx:         10px;          /* glow blur */
  --x-font:       22px;          /* glyph size (modal) */
  --x-font-lg:    24px;          /* glyph size (explorer) */
  --x-shadow:     0 8px 22px rgba(0,0,0,.45);
}

@property --x-rot { syntax:"<angle>"; inherits:false; initial-value:0deg; }

:where(.modal-topbar .close-btn, .explorer-topbar .close-btn){
  /* Layout & sizing (tap-friendly) */
  position: relative; isolation: isolate; display: inline-grid; place-items:center;
  width: var(--x-size); height: var(--x-size); min-width:44px; min-height:44px;
  border-radius: var(--x-radius);
  /* Typography */
  font-weight: 900; line-height: 1; letter-spacing: .01em;
  font-size: var(--x-font);
  /* Base color fallback if no clip support */
  color: var(--accent);
  /* Crisp hit target */
  -webkit-user-select: none; user-select: none;
  -webkit-tap-highlight-color: transparent;
  /* Motion & perf */
  transform: translateZ(0); will-change: transform, filter, box-shadow;
  transition:
    transform .12s ease,
    filter .18s ease,
    text-shadow .18s ease,
    box-shadow .18s ease;
  /* Subtle ambient lift even at rest */
  text-shadow:
    0 0 1px rgba(255,255,255,.65),
    0 0 8px color-mix(in srgb, var(--accent) 45%, transparent),
    0 0 18px color-mix(in srgb, var(--accent-2) 35%, transparent);
}

/* Slightly larger icon in explorer topbar */
.explorer-topbar .close-btn{ font-size: var(--x-font-lg); }

/* Iridescent text treatment (with conic sweep) */
@supports (-webkit-background-clip:text) or (background-clip:text){
  :where(.modal-topbar .close-btn, .explorer-topbar .close-btn){
    background-image:
      conic-gradient(from var(--x-rot) at 50% 50%,
        var(--accent) 0deg,
        var(--accent-2) 140deg,
        var(--accent-3) 260deg,
        var(--accent) 360deg);
    -webkit-background-clip: text; background-clip: text;
    color: transparent; -webkit-text-fill-color: transparent;
    animation: x-rotate 6s linear infinite, x-breathe 2.8s ease-in-out infinite;
  }
}

/* Ambient holo-glow bed */
:where(.modal-topbar .close-btn, .explorer-topbar .close-btn)::before{
  content:""; position:absolute; inset: max(-12px, calc((var(--x-size) - 44px)/-2));
  border-radius: inherit; pointer-events:none; z-index:-1;
  background:
    radial-gradient(62% 62% at 50% 42%,
      color-mix(in srgb, var(--accent) 22%, transparent), transparent 65%),
    conic-gradient(from var(--x-rot),
      color-mix(in srgb, var(--accent) 18%, transparent),
      color-mix(in srgb, var(--accent-2) 12%, transparent),
      color-mix(in srgb, var(--accent-3) 16%, transparent),
      color-mix(in srgb, var(--accent) 18%, transparent));
  filter: blur(var(--x-gx)) saturate(1.1);
  opacity:.75; animation: x-rotate 6s linear infinite;
}

/* Glass ring (subtle, keeps edges tight) */
:where(.modal-topbar .close-btn, .explorer-topbar .close-btn)::after{
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  box-shadow:
    0 0 0 1px color-mix(in srgb, var(--accent) 22%, transparent) inset,
    0 0 0 1px color-mix(in srgb, var(--accent-3) 10%, transparent);
  background:
    radial-gradient(140% 120% at 25% 20%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(to bottom, rgba(255,255,255,.1), rgba(255,255,255,0) 40%);
  mix-blend-mode: screen;
}

/* Hover / Press */
:where(.modal-topbar .close-btn, .explorer-topbar .close-btn):hover{
  transform: translateY(-1px) scale(1.05);
  text-shadow:
    0 0 2px rgba(255,255,255,.9),
    0 0 12px color-mix(in srgb, var(--accent) 65%, transparent),
    0 0 26px color-mix(in srgb, var(--accent-2) 55%, transparent),
    0 0 36px color-mix(in srgb, var(--accent-3) 40%, transparent);
  filter: drop-shadow(0 0 10px color-mix(in srgb, var(--accent) 35%, transparent));
}
:where(.modal-topbar .close-btn, .explorer-topbar .close-btn):active{
  transform: translateY(0) scale(.985);
}

/* Keyboard focus (high-contrast, non-intrusive) */
:where(.modal-topbar .close-btn, .explorer-topbar .close-btn):focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in srgb, var(--accent) 85%, transparent),
    0 0 0 6px color-mix(in srgb, var(--accent-2) 26%, transparent);
}

/* Keyframes */
@keyframes x-rotate { to { --x-rot: 360deg } }
@keyframes x-breathe { 0%,100% { transform:none } 50% { transform: translateY(-.5px) scale(1.06) } }

/* Reduced motion: keep look, drop spin */
@media (prefers-reduced-motion: reduce){
  :where(.modal-topbar .close-btn, .explorer-topbar .close-btn){ animation:none }
  :where(.modal-topbar .close-btn, .explorer-topbar .close-btn)::before{ animation:none }
}

/* Touch-first: ensure 48px target on coarse pointers */
@media (pointer: coarse){
  :root{ --x-size: 48px; --x-font: 24px; --x-font-lg: 26px; }
}

/* Forced colors / high contrast */
@media (forced-colors: active){
  :where(.modal-topbar .close-btn, .explorer-topbar .close-btn){
    background-image: none; -webkit-text-fill-color: CanvasText; color: ButtonText;
    text-shadow: none; box-shadow: 0 0 0 2px Highlight;
  }
  :where(.modal-topbar .close-btn, .explorer-topbar .close-btn)::before,
  :where(.modal-topbar .close-btn, .explorer-topbar .close-btn)::after{ display:none }
}

/* Optional “holo” enhanced variant (glass + aura, tight on mobile) */
:where(.modal-topbar .close-btn.holo, .explorer-topbar .close-btn.holo){
  background:
    radial-gradient(120% 120% at 30% 20%,
      color-mix(in srgb, var(--accent) 22%, transparent),
      color-mix(in srgb, var(--accent-2) 18%, transparent) 50%,
      rgba(255,255,255,.04) 70%, transparent 100%),
    rgba(255,255,255,.06);
  border: 1px solid var(--border);
  -webkit-backdrop-filter: blur(10px) saturate(1.15);
  backdrop-filter: blur(10px) saturate(1.15);
  box-shadow:
    0 0 0 1px color-mix(in srgb, var(--accent) 20%, transparent) inset,
    var(--x-shadow),
    0 0 24px color-mix(in srgb, var(--accent) 22%, transparent);
}

/* Compact variant for ultra-dense UIs (still 40px/44px on touch) */
:where(.close-btn.compact){ --x-size: 36px; --x-font: 20px; }
@media (pointer: coarse){ :where(.close-btn.compact){ --x-size: 44px; --x-font: 22px; } }

/* If you render the glyph inside (recommended for screen readers):
   <button class="close-btn" aria-label="Close"><span aria-hidden="true">×</span></button>
   The styling applies to the button; the span inherits the gradient text.
*/
:where(.modal-topbar .close-btn > *, .explorer-topbar .close-btn > *){
  display:inline-block; line-height:1; transform: translateZ(0);
}

/* ───────────────────────────────────────────────────────────────
   10) Verifier Toggle FAB + Container (SealMoment-synced)
──────────────────────────────────────────────────────────────── */
.verifier-toggle{
  all:unset; position:fixed;
  right:clamp(12px,4vw,20px);
  bottom:calc(clamp(12px,4vw,20px) + env(safe-area-inset-bottom));
  z-index:10001; cursor:pointer;
  display:inline-flex; align-items:center; gap:.5rem;
  padding:clamp(.48rem,1.6vw,.64rem) clamp(.78rem,2vw,1rem);
  min-height:40px; border-radius:999px;
  font:600 clamp(.82rem,1.8vw,.9rem)/1 var(--ff-ui,"JetBrains Mono",ui-monospace); letter-spacing:.02em; text-transform:uppercase;
  color: var(--seal-ink, #031316);

  /* crystal finish */
  background:
    linear-gradient(135deg, color-mix(in srgb, var(--seal-core) 90%, transparent), color-mix(in srgb, var(--seal-aura) 90%, transparent)),
    linear-gradient(to bottom, rgba(255,255,255,.22) 0 8%, rgba(255,255,255,.10) 12% 22%, transparent 38%),
    radial-gradient(60% 80% at 18% 0%, rgba(255,255,255,.22) 0 7%, transparent 20%),
    radial-gradient(70% 90% at 82% 100%, rgba(255,255,255,.16) 0 6%, transparent 18%),
    conic-gradient(from 210deg at 68% 38%, color-mix(in srgb, var(--seal-core) 24%, transparent) 0 10%, transparent 10% 30%, color-mix(in srgb, var(--seal-aura) 18%, transparent) 30% 42%, transparent 42% 100%);
  background-blend-mode: overlay, soft-light, screen, soft-light, color-dodge;
  -webkit-backdrop-filter: blur(6px) saturate(130%) contrast(104%) brightness(1.04);
  backdrop-filter: blur(6px) saturate(130%) contrast(104%) brightness(1.04);

  box-shadow: 0 10px 24px color-mix(in srgb, var(--seal-core) 28%, transparent), inset 0 0 6px rgba(255,255,255,.12);
  transform-origin:100% 100%; transition: transform .22s cubic-bezier(.23,1.46,.45,1.1), box-shadow .22s ease, filter .22s ease;
  touch-action: manipulation; will-change: transform;
  --ring: color-mix(in srgb, var(--seal-aura) 60%, transparent);
}
.verifier-toggle::before{
  content:""; width:clamp(22px,5vw,26px); height:clamp(22px,5vw,26px); border-radius:50%;
  background: radial-gradient(circle, color-mix(in srgb, var(--seal-ink, #031316) 100%, transparent) 0 35%, transparent 60%);
  box-shadow: inset 0 0 10px rgba(0,0,0,.28), 0 0 16px color-mix(in srgb, var(--seal-core) 38%, transparent);
}
.verifier-toggle::after{
  content:""; position:absolute; inset:-6px; border-radius:999px;
  border:1.5px solid color-mix(in srgb, var(--seal-core) 35%, transparent);
  box-shadow: 0 0 14px color-mix(in srgb, var(--seal-core) 35%, transparent);
  opacity:.6; animation: verifier-ring var(--kai-pulse) ease-out infinite; pointer-events:none; will-change: transform, opacity;
}
@keyframes verifier-ring{ 0%{ transform:scale(.94); opacity:.6 } 70%{ transform:scale(1.12); opacity:.18 } 100%{ transform:scale(1.16); opacity:0 } }
.verifier-toggle:hover,
.verifier-toggle:focus-visible{
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 16px 36px color-mix(in srgb, var(--seal-core) 42%, transparent), inset 0 0 10px rgba(255,255,255,.18);
  outline:2px solid var(--ring); outline-offset:3px;
}

.verifier-container{
  position:fixed; inset:0; z-index:10000;
  display:grid; grid-template-areas:"stack"; place-items:center;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.verifier-bg{
  grid-area:stack; position:absolute; inset:0; pointer-events:auto;
  background:
    linear-gradient(to bottom right, color-mix(in srgb, var(--seal-ink, #031316) 92%, transparent), color-mix(in srgb, var(--seal-ink, #031316) 96%, transparent)),
    radial-gradient(circle at 20% 15%, color-mix(in srgb, var(--seal-core) 12%, transparent) 0 8%, transparent 40%),
    radial-gradient(circle at 80% 70%, color-mix(in srgb, var(--seal-aura) 14%, transparent) 0 12%, transparent 45%),
    conic-gradient(from 140deg at 50% 30%, color-mix(in srgb, var(--seal-core) 10%, transparent), transparent 72deg);
  background-blend-mode: normal, screen, screen, normal;
  background-size:100% 100%, 1200px 1200px, 1600px 1600px, 100% 100%;
  animation: bg-star-drift 90s linear infinite, bg-aurora 28s ease-in-out infinite alternate;
  will-change: background-position; filter:saturate(110%);
}
@keyframes bg-star-drift{ from{ background-position:0 0, 0 0, 0 0, center } to{ background-position:0 0, -240px 320px, 180px -260px, center } }
@keyframes bg-aurora{ 0%{background-position-y:0%} 100%{background-position-y:120%} }

.verifier-container .container-shell{
  grid-area:stack; position:relative; width:100%; height:100%;
  display:grid; place-items:center; padding:clamp(8px,2.2vw,24px);
  background:radial-gradient(circle at 50% 40%, color-mix(in srgb, var(--seal-core) 8%, transparent), transparent 60%);
  animation: container-fade .42s ease-out both;
}
@keyframes container-fade{ 0%{opacity:0; transform:translateY(12px) scale(.98)} 100%{opacity:1; transform:none} }

/* Exit FAB */
.verifier-exit{
  all:unset; position:fixed;
  top:calc(16px + env(safe-area-inset-top));
  right:calc(16px + env(safe-area-inset-right));
  z-index:10002;
  width:52px; height:52px; border-radius:50%;
  display:grid; place-items:center; cursor:pointer;
  font:800 1.35rem/1 var(--ff-ui,"JetBrains Mono",ui-monospace);
  color: var(--seal-ink, #031316);
  background: linear-gradient(135deg, var(--seal-core), var(--seal-aura));
  box-shadow: 0 18px 48px color-mix(in srgb, var(--seal-core) 45%, transparent), inset 0 0 12px rgba(255,255,255,.22);
  transition: transform .22s cubic-bezier(.23,1.46,.45,1.1), box-shadow .22s ease, filter .22s ease;
  touch-action: manipulation; --ring: color-mix(in srgb, var(--seal-aura) 75%, transparent);
}
.verifier-exit::after{
  content:""; position:absolute; inset:-8px; border-radius:inherit;
  border:2px solid color-mix(in srgb, var(--seal-core) 45%, transparent);
  box-shadow:0 0 18px color-mix(in srgb, var(--seal-core) 45%, transparent);
  animation: verifier-exit-ring var(--kai-pulse) ease-out infinite; pointer-events:none; will-change: transform, opacity;
}
@keyframes verifier-exit-ring{ 0%{ transform:scale(.85); opacity:.9 } 70%{ transform:scale(1.18); opacity:.25 } 100%{ transform:scale(1.24); opacity:0 } }
.verifier-exit:hover,
.verifier-exit:focus-visible{
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 26px 56px color-mix(in srgb, var(--seal-core) 65%, transparent), inset 0 0 16px rgba(255,255,255,.26);
  outline:2px solid var(--ring); outline-offset:4px;
}

@media (max-width:560px){
  .verifier-exit{
    width:46px; height:46px; font-size:1.2rem;
    top:calc(12px + env(safe-area-inset-top));
    right:calc(12px + env(safe-area-inset-right));
  }
}

/* High contrast / reduced motion for FABs */
@media (prefers-contrast: more){
  .verifier-toggle{ box-shadow:none; border:2px solid var(--seal-core) }
  .verifier-toggle::after{ display:none }
  .verifier-exit{ box-shadow:none; border:2px solid var(--seal-core); background: var(--seal-core); color:#001316 }
  .verifier-exit::after{ display:none }
}
@media (prefers-reduced-motion: reduce){
  .verifier-toggle, .verifier-toggle::after, .verifier-bg, .verifier-container .container-shell, .verifier-exit, .verifier-exit::after{
    animation-duration:.01ms !important; animation-iteration-count:1 !important; transition:none !important;
  }
}

/* ───────────────────────────────────────────────────────────────
   11) Pulse-synced countdown (use .countdown + .imminent)
──────────────────────────────────────────────────────────────── */
.countdown{
  --p: var(--kai-pulse); --c: var(--chakra, var(--seal-core, #00ffe0));
  margin:10px 0; display:inline-flex; align-items:baseline; gap:.35rem;
  font-family:'Orbitron','Rajdhani','JetBrains Mono',ui-monospace,monospace;
  font-size: clamp(1rem, 2.6vw, 1.25rem); letter-spacing:.02em; color:#e9ffff; text-align:center;
  text-shadow: 0 0 6px rgba(255,255,255,.28), 0 0 12px rgba(160,220,255,.35), 0 0 20px rgba(120,180,255,.55);
  animation: countdown-breathe var(--p) linear infinite;
}
.countdown strong{
  font-variant-numeric: tabular-nums; font-weight:800; font-size:1.15em; line-height:1; color:#fff; letter-spacing:.01em;
  text-shadow:
    0 0 10px color-mix(in oklab, var(--c), white 10%),
    0 0 18px color-mix(in oklab, var(--c), #8cfaff 10%),
    0 0 28px color-mix(in oklab, var(--c), #00f0ff 0%);
  animation: tick-pop .18s cubic-bezier(.24,1.35,.45,1.05);
}
.countdown.imminent{
  color:#fff5f5;
  text-shadow: 0 0 10px rgba(255,120,120,.65), 0 0 24px rgba(255,80,80,.45), 0 0 36px rgba(255,40,40,.35);
  animation: countdown-imminent .45s ease-in-out infinite;
}
.countdown.imminent strong{
  text-shadow: 0 0 12px rgba(255,180,180,.95), 0 0 26px rgba(255,120,120,.75), 0 0 40px rgba(255,80,80,.55);
}
@keyframes countdown-breathe{
  0%{ text-shadow: 0 0 6px rgba(255,255,255,.28), 0 0 12px rgba(160,220,255,.35), 0 0 20px rgba(120,180,255,.55) }
  50%{ text-shadow: 0 0 10px color-mix(in oklab, var(--c), white 10%), 0 0 22px color-mix(in oklab, var(--c), #8cfaff 25%), 0 0 38px color-mix(in oklab, var(--c), #00f0ff 10%) }
  100%{ text-shadow: 0 0 6px rgba(255,255,255,.28), 0 0 12px rgba(160,220,255,.35), 0 0 20px rgba(120,180,255,.55) }
}
@keyframes tick-pop{ 0%{ transform: translateY(.5px) scale(.96) } 100%{ transform:none } }
@keyframes countdown-imminent{ 0%,100%{ transform:none; filter:saturate(110%) } 50%{ transform: translateY(-1px) scale(1.02); filter:saturate(140%) } }
@media (prefers-reduced-motion: reduce){
  .countdown, .countdown strong{ animation:none !important; text-shadow: 0 0 6px rgba(255,255,255,.28), 0 0 12px rgba(160,220,255,.35) }
}

/* ───────────────────────────────────────────────────────────────
   12) Rich JSON altar (gloss, drift, polish)
──────────────────────────────────────────────────────────────── */
.rich-grid .json-altar pre.json,
.rich-grid .json-altar code.json,
.rich-grid .json-altar pre code{
  color: var(--ink);
  font-variant-numeric: tabular-nums;
  text-shadow: 0 0 .45px rgba(255,255,255,.35), 0 6px 22px color-mix(in srgb, var(--accent) 18%, transparent), 0 0 36px color-mix(in srgb, var(--accent-2) 16%, transparent);
}
.rich-grid .json-altar pre.json{ position:relative; isolation:isolate }
.rich-grid .json-altar pre.json::before{
  content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
  background:
    linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,0) 38%),
    radial-gradient(120% 160% at 12% -10%, color-mix(in srgb, var(--accent) 12%, transparent), transparent 62%),
    radial-gradient(120% 160% at 88% 110%, color-mix(in srgb, var(--accent-2) 10%, transparent), transparent 62%);
  mix-blend-mode: screen; z-index:1;
}
.rich-grid .json-altar pre.json::after{
  content:""; position:absolute; inset:-35%; pointer-events:none; border-radius:inherit;
  background: conic-gradient(from 0deg at 50% 50%, transparent 0 34%, color-mix(in srgb, var(--accent) 10%, transparent) 42%, color-mix(in srgb, var(--accent-2) 10%, transparent) 56%, transparent 64% 100%);
  filter: blur(26px); animation: altarDrift 22s linear infinite; opacity:.45; z-index:0;
}
@keyframes altarDrift{ from{ transform: rotate(0deg) scale(1.02) } to{ transform: rotate(360deg) scale(1.02) } }
@media (prefers-reduced-motion: reduce){ .rich-grid .json-altar pre.json::after{ animation:none; opacity:.35 } }

.rich-grid .json-altar pre.json{
  background:
    linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.015)),
    repeating-linear-gradient(0deg, color-mix(in srgb, var(--accent) 5%, transparent) 0, color-mix(in srgb, var(--accent) 5%, transparent) 28px, transparent 28px, transparent 56px),
    #0d1020;
  scrollbar-width: thin; scrollbar-color: color-mix(in srgb, var(--accent) 35%, transparent) transparent;
  content-visibility:auto; contain: paint; contain-intrinsic-size: 1200px 800px; scroll-behavior:auto;
}
.rich-grid .json-altar pre.json::-webkit-scrollbar{ height:10px; width:10px }
.rich-grid .json-altar pre.json::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 35%, transparent), color-mix(in srgb, var(--accent-2) 35%, transparent));
  border-radius:10px;
}
.rich-grid .json-altar pre.json::-webkit-scrollbar-track{ background: transparent }
.rich-grid .json-altar pre.json:focus-visible{
  outline: 2px solid color-mix(in srgb, var(--accent) 45%, transparent); outline-offset:2px;
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent) 25%, transparent) inset, 0 12px 34px color-mix(in srgb, var(--accent) 18%, transparent);
}

/* ───────────────────────────────────────────────────────────────
   13) RICH DATA summary holo ink
──────────────────────────────────────────────────────────────── */
details.rich-data > summary{
  position:relative; will-change: transform, text-shadow, filter, background-position; transform-origin:center;
  color:transparent; -webkit-text-fill-color: transparent;
  background:
    conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2), var(--accent-3), var(--accent)),
    radial-gradient(120% 180% at 10% 0%, color-mix(in srgb, var(--accent) 35%, transparent), transparent 60%);
  -webkit-background-clip:text; background-clip:text;
  -webkit-text-stroke: 0.55px rgba(255,255,255,.28);
  text-shadow: 0 0 .5px rgba(255,255,255,.35), 0 6px 22px color-mix(in srgb, var(--accent) 26%, transparent);
  background-size:200% 200%;
  animation: holoBreath 5.236s ease-in-out infinite, holoShiftSlow 10.472s linear infinite;
}
details.rich-data > summary::before{
  content:""; position:absolute; inset:0; z-index:-1; border-radius: var(--radius-lg);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)), radial-gradient(120% 180% at 10% 0%, color-mix(in srgb, var(--accent) 10%, transparent), transparent 60%);
  border: 1px solid var(--border); box-shadow: 0 10px 28px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05);
  will-change: box-shadow, filter; animation: barHalo 5.236s ease-in-out infinite;
}
details.rich-data > summary::after{ animation: caretBreath 5.236s ease-in-out infinite; filter: drop-shadow(0 0 0 rgba(120,247,255,0)) }
@keyframes holoBreath{
  0%,100%{ transform:none; text-shadow: 0 0 .45px rgba(255,255,255,.35), 0 4px 16px color-mix(in srgb, var(--accent) 20%, transparent), 0 0 24px color-mix(in srgb, var(--accent-2) 14%, transparent); letter-spacing:.06em; filter: brightness(1) saturate(1) }
  50%{ transform: scale(1.015); text-shadow: 0 0 .7px rgba(255,255,255,.5), 0 10px 32px color-mix(in srgb, var(--accent) 38%, transparent), 0 0 54px color-mix(in srgb, var(--accent-2) 26%, transparent); letter-spacing:.08em; filter: brightness(1.03) saturate(1.06) }
}
@keyframes barHalo{
  0%,100%{ box-shadow: 0 10px 28px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05) }
  50%{ box-shadow: 0 18px 44px color-mix(in srgb, var(--accent) 24%, transparent), inset 0 0 0 1px color-mix(in srgb, var(--accent) 22%, transparent) }
}
@keyframes caretBreath{ 0%,100%{ filter: drop-shadow(0 0 0 rgba(120,247,255,0)); transform: translateY(0) rotate(45deg) } 50%{ filter: drop-shadow(0 0 6px color-mix(in srgb, var(--accent) 45%, transparent)); transform: translateY(-1px) rotate(45deg) } }
@keyframes holoShiftSlow{ 0%{ background-position:0% 50% } 100%{ background-position:200% 50% } }
@media (prefers-reduced-motion: reduce){
  details.rich-data > summary,
  details.rich-data > summary::before,
  details.rich-data > summary::after{ animation:none !important }
}

/* ───────────────────────────────────────────────────────────────
   14) Responsiveness & mobile performance
──────────────────────────────────────────────────────────────── */
@media (max-width: 840px){
  .summary-grid{ grid-template-columns: 1fr }
  .summary-grid .kv{ grid-template-columns: 110px 1fr }
  .transfer .row{ grid-template-columns: 120px 1fr }
  .fab-stack{ top:94px; right:10px }
}
@media (max-width: 560px){
  .toolbar{ padding:10px }
  .toolbar h1{ font-size:18px; letter-spacing: .07em }
  button{ padding:9px 12px }
  .modal-header{ grid-template-columns: 56px 1fr }
  .fab{ width:40px; height:40px }
  .explorer-body .meta-row{ grid-template-columns: 1fr } /* stack actions under text */
  .explorer-body .meta-row :is(button, .button, [role="button"]){ justify-self:start }
}
@media (max-width: 360px){
  .modal-header img{ width:52px; height:52px }
  .toolbar-actions{ gap:8px }
}

/* Touch ergonomics: 44px minimum */
@media (hover: none) and (pointer: coarse){
  :where(button, .chip, .fab, .close-btn, .toolbar-actions > *, .verifier-toggle, .verifier-exit){
    min-height: 44px; min-width: 44px;
  }
  .toolbar, .explorer-topbar, .modal-topbar, .tabs{
    -webkit-backdrop-filter: blur(8px) saturate(1.1);
    backdrop-filter: blur(8px) saturate(1.1);
    box-shadow: 0 4px 16px rgba(0,0,0,.32), inset 0 0 0 1px var(--border);
  }
  input, select, textarea{ font-size:16px } /* iOS no-zoom */
  :where(.verifier-stamper, .toolbar, .glass, .fab, dialog.glass-modal, .transfer, .summary-grid .kv){
    box-shadow: 0 6px 20px rgba(0,0,0,0.34), inset 0 0 0 1px var(--border);
  }
}

/* Scroll isolation & momentum */
:where(.modal-body, .explorer-body, .status-strip){
  overscroll-behavior: contain; -webkit-overflow-scrolling: touch;
  content-visibility: auto; contain: layout paint style; contain-intrinsic-size: 800px 600px;
}

/* Freeze page behind dialogs (extra iOS guard) */
:root:has(dialog[open]),
:root:has(.verifier-container){ overflow:hidden; touch-action:none }

/* Prevent horizontal overflow anywhere critical */
:where(dialog.glass-modal, .explorer-dialog, .modal-viewport, .status-strip, .modal-header, .tabs, .modal-body, .modal-footer, .explorer-body, .toolbar, .explorer-chrome, .explorer-topbar, .summary-grid, .transfer){
  max-width: 100%; overflow-x: clip;
}

/* Media & canvas safety */
img, svg, video, canvas, iframe{ max-width:100%; height:auto; display:block; -webkit-user-drag:none; user-drag:none; image-rendering:auto }

/* Subtle scrollbar polish (global, non-intrusive) */
*{ scrollbar-width: thin; scrollbar-color: color-mix(in srgb, var(--accent) 35%, transparent) transparent }
*::-webkit-scrollbar{ height:8px; width:8px }
*::-webkit-scrollbar-thumb{ background: color-mix(in srgb, var(--accent) 28%, transparent); border-radius:8px }
*::-webkit-scrollbar-track{ background: transparent }

/* Safe-area padding for bars */
@supports (padding: max(0px)){
  .explorer-topbar, .modal-topbar, .modal-footer{
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
}
.explorer-dialog{ padding-bottom: env(safe-area-inset-bottom, 0) }
.explorer-body{ padding-bottom: max(16px, env(safe-area-inset-bottom, 0)) }

/* Reduced motion global softening */
@media (prefers-reduced-motion: reduce){
  *{ transition-duration: 0.001s !important }
  .toolbar h1, .toolbar .brand-lockup h3, .explorer-title{ animation: none !important }
}

/* ───────────────────────────────────────────────────────────────
   15) Explorer stream header cleanup + right-edge safety
──────────────────────────────────────────────────────────────── */
.explorer-body .stream-title,
.explorer-body .stream-header,
.explorer-body header.stream-header,
.explorer-body .stream{ display:none !important }
.explorer-body > h1:first-child,
.explorer-body > h2:first-child{ display:none !important }
.explorer-body, .explorer-body *{ max-width:100% }
.explorer-body .card, .explorer-body .panel{ overflow:hidden }
.explorer-body .meta-row{
  display:grid; grid-template-columns: 1fr auto; align-items:center; gap:10px; min-width:0;
}
.explorer-body .meta-row .keystream,
.explorer-body .meta-row [data-keystream],
.explorer-body .meta-row [data-role="keystream"]{ margin-top:2px }
/* sovereign zk chips (works with data-state on the row) */
.row.zk-send .k::after { content: " (SO)"; margin-left: 6px; color: var(--muted); }
.row.zk-recv .k::after { content: " (RO)"; margin-left: 6px; color: var(--muted); }

.zk-pill {
  display:inline-flex; align-items:center; gap:8px; height:24px;
  padding:0 10px; border-radius:999px; font-size:12px;
  border:1px solid var(--border); background: var(--glass);
}
.zk-dot { width:8px; height:8px; border-radius:50%; background: var(--muted); }

.row.zk-send[data-state="verified"] .v,
.row.zk-recv[data-state="verified"] .v { color: var(--ok); }
.row.zk-send[data-state="pending"] .v,
.row.zk-recv[data-state="pending"] .v { color: var(--warn); }
.row.zk-send[data-state="failed"] .v,
.row.zk-recv[data-state="failed"] .v  { color: var(--err); }
.row.zk-send[data-state="unavailable"] .v,
.row.zk-recv[data-state="unavailable"] .v { color: var(--muted); }

.row.zk-send[data-state="verified"] .zk-dot,
.row.zk-recv[data-state="verified"] .zk-dot { background: var(--ok); }
.row.zk-send[data-state="pending"] .zk-dot,
.row.zk-recv[data-state="pending"] .zk-dot { background: var(--warn); }
.row.zk-send[data-state="failed"] .zk-dot,
.row.zk-recv[data-state="failed"] .zk-dot  { background: var(--err); }
